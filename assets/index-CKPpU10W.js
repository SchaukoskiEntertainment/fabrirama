(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();var J=1e-6,j=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});function q(){var o=new j(16);return j!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function mt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function xt(o,t){var e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],a=t[5],h=t[6],u=t[7],d=t[8],m=t[9],f=t[10],y=t[11],k=t[12],E=t[13],b=t[14],w=t[15],R=e*a-s*r,v=e*h-i*r,L=e*u-n*r,T=s*h-i*a,B=s*u-n*a,O=i*u-n*h,F=d*E-m*k,G=d*b-f*k,Z=d*w-y*k,Q=m*b-f*E,tt=m*w-y*E,et=f*w-y*b,_=R*et-v*tt+L*Q+T*Z-B*G+O*F;return _?(_=1/_,o[0]=(a*et-h*tt+u*Q)*_,o[1]=(i*tt-s*et-n*Q)*_,o[2]=(E*O-b*B+w*T)*_,o[3]=(f*B-m*O-y*T)*_,o[4]=(h*Z-r*et-u*G)*_,o[5]=(e*et-i*Z+n*G)*_,o[6]=(b*L-k*O-w*v)*_,o[7]=(d*O-f*L+y*v)*_,o[8]=(r*tt-a*Z+u*F)*_,o[9]=(s*Z-e*tt-n*F)*_,o[10]=(k*B-E*L+w*R)*_,o[11]=(m*L-d*B-y*R)*_,o[12]=(a*G-r*Q-h*F)*_,o[13]=(e*Q-s*G+i*F)*_,o[14]=(E*v-k*T-b*R)*_,o[15]=(d*T-m*v+f*R)*_,o):null}function St(o,t,e){var s=t[0],i=t[1],n=t[2],r=t[3],a=t[4],h=t[5],u=t[6],d=t[7],m=t[8],f=t[9],y=t[10],k=t[11],E=t[12],b=t[13],w=t[14],R=t[15],v=e[0],L=e[1],T=e[2],B=e[3];return o[0]=v*s+L*a+T*m+B*E,o[1]=v*i+L*h+T*f+B*b,o[2]=v*n+L*u+T*y+B*w,o[3]=v*r+L*d+T*k+B*R,v=e[4],L=e[5],T=e[6],B=e[7],o[4]=v*s+L*a+T*m+B*E,o[5]=v*i+L*h+T*f+B*b,o[6]=v*n+L*u+T*y+B*w,o[7]=v*r+L*d+T*k+B*R,v=e[8],L=e[9],T=e[10],B=e[11],o[8]=v*s+L*a+T*m+B*E,o[9]=v*i+L*h+T*f+B*b,o[10]=v*n+L*u+T*y+B*w,o[11]=v*r+L*d+T*k+B*R,v=e[12],L=e[13],T=e[14],B=e[15],o[12]=v*s+L*a+T*m+B*E,o[13]=v*i+L*h+T*f+B*b,o[14]=v*n+L*u+T*y+B*w,o[15]=v*r+L*d+T*k+B*R,o}function X(o,t,e){var s=e[0],i=e[1],n=e[2],r,a,h,u,d,m,f,y,k,E,b,w;return t===o?(o[12]=t[0]*s+t[4]*i+t[8]*n+t[12],o[13]=t[1]*s+t[5]*i+t[9]*n+t[13],o[14]=t[2]*s+t[6]*i+t[10]*n+t[14],o[15]=t[3]*s+t[7]*i+t[11]*n+t[15]):(r=t[0],a=t[1],h=t[2],u=t[3],d=t[4],m=t[5],f=t[6],y=t[7],k=t[8],E=t[9],b=t[10],w=t[11],o[0]=r,o[1]=a,o[2]=h,o[3]=u,o[4]=d,o[5]=m,o[6]=f,o[7]=y,o[8]=k,o[9]=E,o[10]=b,o[11]=w,o[12]=r*s+d*i+k*n+t[12],o[13]=a*s+m*i+E*n+t[13],o[14]=h*s+f*i+b*n+t[14],o[15]=u*s+y*i+w*n+t[15]),o}function at(o,t,e){var s=e[0],i=e[1],n=e[2];return o[0]=t[0]*s,o[1]=t[1]*s,o[2]=t[2]*s,o[3]=t[3]*s,o[4]=t[4]*i,o[5]=t[5]*i,o[6]=t[6]*i,o[7]=t[7]*i,o[8]=t[8]*n,o[9]=t[9]*n,o[10]=t[10]*n,o[11]=t[11]*n,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function ht(o,t,e){var s=Math.sin(e),i=Math.cos(e),n=t[4],r=t[5],a=t[6],h=t[7],u=t[8],d=t[9],m=t[10],f=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=n*i+u*s,o[5]=r*i+d*s,o[6]=a*i+m*s,o[7]=h*i+f*s,o[8]=u*i-n*s,o[9]=d*i-r*s,o[10]=m*i-a*s,o[11]=f*i-h*s,o}function it(o,t,e){var s=Math.sin(e),i=Math.cos(e),n=t[0],r=t[1],a=t[2],h=t[3],u=t[8],d=t[9],m=t[10],f=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=n*i-u*s,o[1]=r*i-d*s,o[2]=a*i-m*s,o[3]=h*i-f*s,o[8]=n*s+u*i,o[9]=r*s+d*i,o[10]=a*s+m*i,o[11]=h*s+f*i,o}function pt(o,t,e){var s=Math.sin(e),i=Math.cos(e),n=t[0],r=t[1],a=t[2],h=t[3],u=t[4],d=t[5],m=t[6],f=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=n*i+u*s,o[1]=r*i+d*s,o[2]=a*i+m*s,o[3]=h*i+f*s,o[4]=u*i-n*s,o[5]=d*i-r*s,o[6]=m*i-a*s,o[7]=f*i-h*s,o}function _t(o,t,e,s,i){var n=1/Math.tan(t/2),r;return o[0]=n/e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,i!=null&&i!==1/0?(r=1/(s-i),o[10]=(i+s)*r,o[14]=2*i*s*r):(o[10]=-1,o[14]=-2*s),o}var Ut=_t;function Et(o,t,e,s){var i,n,r,a,h,u,d,m,f,y,k=t[0],E=t[1],b=t[2],w=s[0],R=s[1],v=s[2],L=e[0],T=e[1],B=e[2];return Math.abs(k-L)<J&&Math.abs(E-T)<J&&Math.abs(b-B)<J?mt(o):(d=k-L,m=E-T,f=b-B,y=1/Math.hypot(d,m,f),d*=y,m*=y,f*=y,i=R*f-v*m,n=v*d-w*f,r=w*m-R*d,y=Math.hypot(i,n,r),y?(y=1/y,i*=y,n*=y,r*=y):(i=0,n=0,r=0),a=m*r-f*n,h=f*i-d*r,u=d*n-m*i,y=Math.hypot(a,h,u),y?(y=1/y,a*=y,h*=y,u*=y):(a=0,h=0,u=0),o[0]=i,o[1]=a,o[2]=d,o[3]=0,o[4]=n,o[5]=h,o[6]=m,o[7]=0,o[8]=r,o[9]=u,o[10]=f,o[11]=0,o[12]=-(i*k+n*E+r*b),o[13]=-(a*k+h*E+u*b),o[14]=-(d*k+m*E+f*b),o[15]=1,o)}function U(){var o=new j(3);return j!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function N(o){var t=new j(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function Ht(o){var t=o[0],e=o[1],s=o[2];return Math.hypot(t,e,s)}function $(o,t,e){var s=new j(3);return s[0]=o,s[1]=t,s[2]=e,s}function kt(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o}function Bt(o,t,e){return o[0]=t[0]+e[0],o[1]=t[1]+e[1],o[2]=t[2]+e[2],o}function Gt(o,t,e){return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],o}function st(o,t,e,s){return o[0]=t[0]+e[0]*s,o[1]=t[1]+e[1]*s,o[2]=t[2]+e[2]*s,o}function nt(o,t){var e=t[0],s=t[1],i=t[2],n=e*e+s*s+i*i;return n>0&&(n=1/Math.sqrt(n)),o[0]=t[0]*n,o[1]=t[1]*n,o[2]=t[2]*n,o}function Vt(o,t,e){var s=t[0],i=t[1],n=t[2],r=e[0],a=e[1],h=e[2];return o[0]=i*h-n*a,o[1]=n*r-s*h,o[2]=s*a-i*r,o}function Kt(o,t,e,s){var i=t[0],n=t[1],r=t[2];return o[0]=i+s*(e[0]-i),o[1]=n+s*(e[1]-n),o[2]=r+s*(e[2]-r),o}function Wt(o,t){var e=o[0],s=o[1],i=o[2],n=t[0],r=t[1],a=t[2];return Math.abs(e-n)<=J*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(s-r)<=J*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(i-a)<=J*Math.max(1,Math.abs(i),Math.abs(a))}var Mt=Gt;(function(){var o=U();return function(t,e,s,i,n,r){var a,h;for(e||(e=3),s||(s=0),i?h=Math.min(i*e+s,t.length):h=t.length,a=s;a<h;a+=e)o[0]=t[a],o[1]=t[a+1],o[2]=t[a+2],n(o,o,r),t[a]=o[0],t[a+1]=o[1],t[a+2]=o[2];return t}})();const Yt=!1,P=document.getElementById("glCanvas"),Ot=P.getContext("webgl",{alpha:Yt});if(!Ot)throw new Error("Gl is null!");const l=Ot;class lt{constructor(t,e){this.nameId=t,this.mesh=e,this.model=q(),this.position=U(),this.scale=[1,1,1],this.rotation=$(0,0,0),this.visible=!0,this.handItem=!1,this.rotate90=!0}getRotate90(){return this.rotate90}getHandItem(){return this.handItem}getModel(){return this.model}update(t,e){}getNameId(){return this.nameId}setVisible(t){this.visible=t}getVisible(){return this.visible}}class Xt{constructor(){this.texture=null,this.isLoaded=!1,this.image=null}loadFromUrl(t){return new Promise((e,s)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{e()},i.onerror=()=>s(new Error("Failed to load texture image")),i.src=t,this.image=i})}createTexture(t){this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.bindTexture(l.TEXTURE_2D,null),this.isLoaded=!0}bind(t=0){!this.isLoaded||!this.texture||(l.activeTexture(l.TEXTURE0+t),l.bindTexture(l.TEXTURE_2D,this.texture))}unbind(){l.bindTexture(l.TEXTURE_2D,null)}isTextureLoaded(){return this.isLoaded}getWebGLTexture(){return this.texture}getImage(){return this.image}}let ut=null;function $t(o){return ut=new Xt,ut.loadFromUrl(o)}function dt(){if(!ut)throw new Error("Blocks texture has not been loaded yet.");return ut}class Nt{constructor(t,e=16,s=3){this.texture=t,this.tileSize=e,this.padding=s;const i=t.getImage();if(i!=null)this.paddedCanvas=this.generatePaddedAtlas(i,this.tileSize,this.padding),this.atlasSize=this.paddedCanvas.width,this.imageData=this.ctx.getImageData(0,0,this.atlasSize,this.atlasSize),t.createTexture(this.paddedCanvas);else throw new Error("Texture image not loaded")}generatePaddedAtlas(t,e=16,s=2){const i=t.width/e,n=e+s*2,r=i*n,a=document.createElement("canvas");a.width=r,a.height=r,this.ctx=a.getContext("2d"),this.ctx.imageSmoothingEnabled=!1;for(let h=0;h<i*i;h++){const u=h%i,d=Math.floor(h/i),m=u*e,f=d*e,y=u*n+s,k=d*n+s;this.ctx.drawImage(t,m,f,e,e,y,k,e,e);for(let E=0;E<e;E++)this.ctx.drawImage(t,m+E,f,1,1,y+E,k-s,1,s),this.ctx.drawImage(t,m+E,f+e-1,1,1,y+E,k+e,1,s);for(let E=0;E<e;E++)this.ctx.drawImage(t,m,f+E,1,1,y-s,k+E,s,1),this.ctx.drawImage(t,m+e-1,f+E,1,1,y+e,k+E,s,1);this.ctx.drawImage(t,m,f,1,1,y-s,k-s,s,s),this.ctx.drawImage(t,m+e-1,f,1,1,y+e,k-s,s,s),this.ctx.drawImage(t,m,f+e-1,1,1,y-s,k+e,s,s),this.ctx.drawImage(t,m+e-1,f+e-1,1,1,y+e,k+e,s,s)}return a}getPixelColor(t,e,s){const i=this.tileSize+this.padding*2,n=Math.floor(this.atlasSize/i),r=s%n,a=Math.floor(s/n);t=r*i+this.padding+t,e=a*i+this.padding+e;const h=(e*this.atlasSize+t)*4,u=this.imageData.data;return{r:u[h],g:u[h+1],b:u[h+2],a:u[h+3]}}getUVs(t){const e=this.tileSize+this.padding*2,s=Math.floor(this.atlasSize/e),i=t%s,n=Math.floor(t/s),r=this.atlasSize,a=this.atlasSize,h=(i*e+this.padding)/r,u=(n*e+this.padding)/a,d=h+this.tileSize/r,m=u+this.tileSize/a;return[h,u,d,u,h,m,d,m]}getTexture(){return this.texture}}function Jt(o){const t=g[o];return jt[t]}var K=(o=>(o[o.TOP=0]="TOP",o[o.BOTTOM=1]="BOTTOM",o[o.LEFT=2]="LEFT",o[o.RIGHT=3]="RIGHT",o[o.FRONT=4]="FRONT",o[o.BACK=5]="BACK",o))(K||{}),g=(o=>(o[o.AIR=0]="AIR",o[o.GRASS=1]="GRASS",o[o.STONE=2]="STONE",o[o.LEAVES=3]="LEAVES",o[o.OAKWOOD=4]="OAKWOOD",o[o.BRICKWOOD=5]="BRICKWOOD",o[o.DIRT=6]="DIRT",o[o.BREAK1=7]="BREAK1",o[o.BREAK2=8]="BREAK2",o[o.BREAK3=9]="BREAK3",o[o.BREAK4=10]="BREAK4",o[o.BREAK5=11]="BREAK5",o[o.BREAK6=12]="BREAK6",o[o.PORTAL1=13]="PORTAL1",o[o.PORTAL2=14]="PORTAL2",o[o.REDCUBE=15]="REDCUBE",o[o.LABBLOCK=16]="LABBLOCK",o[o.LABBLOCK2=17]="LABBLOCK2",o))(g||{});const It=[.9,.5,.5,.7,.8,.6],jt={AIR:{TOP:0,BOTTOM:0,LEFT:0,RIGHT:0,FRONT:0,BACK:0},GRASS:{TOP:2,BOTTOM:0,LEFT:1,RIGHT:1,FRONT:1,BACK:1},STONE:{TOP:3,BOTTOM:3,LEFT:3,RIGHT:3,FRONT:3,BACK:3},LEAVES:{TOP:6,BOTTOM:6,LEFT:6,RIGHT:6,FRONT:6,BACK:6},OAKWOOD:{TOP:5,BOTTOM:5,LEFT:4,RIGHT:4,FRONT:4,BACK:4},BRICKWOOD:{TOP:20,BOTTOM:20,LEFT:20,RIGHT:20,FRONT:20,BACK:20},DIRT:{TOP:0,BOTTOM:0,LEFT:0,RIGHT:0,FRONT:0,BACK:0},BREAK1:{TOP:9,BOTTOM:9,LEFT:9,RIGHT:9,FRONT:9,BACK:9},BREAK2:{TOP:10,BOTTOM:10,LEFT:10,RIGHT:10,FRONT:10,BACK:10},BREAK3:{TOP:11,BOTTOM:11,LEFT:11,RIGHT:11,FRONT:11,BACK:11},BREAK4:{TOP:12,BOTTOM:12,LEFT:12,RIGHT:12,FRONT:12,BACK:12},BREAK5:{TOP:13,BOTTOM:13,LEFT:13,RIGHT:13,FRONT:13,BACK:13},BREAK6:{TOP:14,BOTTOM:14,LEFT:14,RIGHT:14,FRONT:14,BACK:14},PORTAL1:{TOP:21,BOTTOM:21,LEFT:21,RIGHT:21,FRONT:21,BACK:21},PORTAL2:{TOP:22,BOTTOM:22,LEFT:22,RIGHT:22,FRONT:22,BACK:22},REDCUBE:{TOP:15,BOTTOM:15,LEFT:15,RIGHT:15,FRONT:15,BACK:15},LABBLOCK:{TOP:33,BOTTOM:33,LEFT:33,RIGHT:33,FRONT:33,BACK:33},LABBLOCK2:{TOP:34,BOTTOM:34,LEFT:34,RIGHT:34,FRONT:34,BACK:34}},V=[-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5];class Lt{constructor(t,e,s=!1){this.uvBuffer=null,this.brightnessBuffer=null,this.emptyVertices=[],this.uvs=[],this.brightness=[],this.currentIndice=0,this.textureAtlas=new Nt(dt(),16),this.drawLinesInsteadTriangles=!1,this.drawLinesInsteadTriangles=s,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=[],this.indices=[],this.indexVertices=t,this.shader=e}updateBuffers(){l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.vertices),l.DYNAMIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.uvs),l.DYNAMIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.brightness),l.DYNAMIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),l.DYNAMIC_DRAW)}getBrightnessBuffer(){return this.brightnessBuffer}getVertexBuffer(){return this.vertexBuffer}getUvBuffer(){return this.uvBuffer}set chunk(t){this._chunk=t}generateMeshData(t){this._chunk=t;for(let e=0;e<this._chunk.getChunkWidth();e++)for(let s=0;s<this._chunk.getChunkHeight();s++)for(let i=0;i<this._chunk.getChunkDepth();i++)this._chunk.getBlocks()[e][s][i]!=0&&this.createCube(e,s,i);this.init()}createCube(t,e,s){!this.hasBlock(t,e+1,s)&&this.indexVertices[t][e][s][0]==null&&this.createFace(0,t,e,s),!this.hasBlock(t,e-1,s)&&this.indexVertices[t][e][s][1]==null&&this.createFace(1,t,e,s),!this.hasBlock(t-1,e,s)&&this.indexVertices[t][e][s][2]==null&&this.createFace(2,t,e,s),!this.hasBlock(t+1,e,s)&&this.indexVertices[t][e][s][3]==null&&this.createFace(3,t,e,s),!this.hasBlock(t,e,s+1)&&this.indexVertices[t][e][s][4]==null&&this.createFace(4,t,e,s),!this.hasBlock(t,e,s-1)&&this.indexVertices[t][e][s][5]==null&&this.createFace(5,t,e,s)}hasBlock(t,e,s){if(this._chunk.getNameId()=="HandItemCube")return 0;if(t>this._chunk.getChunkWidth()-1){const i=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(i){const n=parseInt(i[1]),r=parseInt(i[2]),a=c.getEntityByName(`Chunk[${n+1},${r}]`);if(a&&a.getBlocks()[0][e]&&a.getBlocks()[0][e][s]!=0)return a.getBlocks()[0][e][s]}return 0}else if(t<0){const i=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(i){const n=parseInt(i[1]),r=parseInt(i[2]),a=c.getEntityByName(`Chunk[${n-1},${r}]`);if(a&&a.getBlocks()[a.getChunkWidth()-1][e]&&a.getBlocks()[a.getChunkWidth()-1][e][s]!=0)return a.getBlocks()[a.getChunkWidth()-1][e][s]}return 0}else if(s>this._chunk.getChunkDepth()-1){const i=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(i){const n=parseInt(i[1]),r=parseInt(i[2]),a=c.getEntityByName(`Chunk[${n},${r+1}]`);if(a&&a.getBlocks()[t][e]&&a.getBlocks()[t][e][0]!=0)return a.getBlocks()[t][e][0]}return 0}else if(s<0){const i=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(i){const n=parseInt(i[1]),r=parseInt(i[2]),a=c.getEntityByName(`Chunk[${n},${r-1}]`);if(a&&a.getBlocks()[t][e]&&a.getBlocks()[t][e][a.getChunkDepth()-1]!=0)return a.getBlocks()[t][e][a.getChunkDepth()-1]}return 0}return e<0||e>this._chunk.getChunkHeight()-1?0:this._chunk.getBlocks()[t][e][s]}getShader(){return this.shader}removeBlockMeshAndAdd(t){t=[Math.floor(t[0]+.5),Math.floor(t[1]+.5),Math.floor(t[2]+.5)];let[e,s,i]=t;if(e=(e%16+16)%16,i=(i%16+16)%16,this.hasBlock(e,s,i)){for(let n=0;n<6;n++){const r=this.indexVertices[e][s][i][n];if(r!=null){this.emptyVertices.push(r);let a=this.getVertices();for(let h=0;h<12;h++)a[r/4+h]=0;l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferSubData(l.ARRAY_BUFFER,r,new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])),this.indexVertices[e][s][i][n]=null}}this.addMeshBlock([e,s,i])}}addMeshBlock(t){t=[Math.floor(t[0]+.5),Math.floor(t[1]+.5),Math.floor(t[2]+.5)];const[e,s,i]=t;if(this.hasBlock(e,s,i))if(e>this._chunk.getChunkWidth()-1){const n=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(n){const r=parseInt(n[1]),a=parseInt(n[2]),h=c.getEntityByName(`Chunk[${r+1},${a}]`);h&&h.getBlocks()[0][s][i]!=0&&(h.mesh.createCube(0,s,i),h.updateChunk())}}else if(e<0){const n=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(n){const r=parseInt(n[1]),a=parseInt(n[2]),h=c.getEntityByName(`Chunk[${r-1},${a}]`);h&&h.getBlocks()[this._chunk.getChunkWidth()-1][s][i]!=0&&(h.mesh.createCube(this._chunk.getChunkWidth()-1,s,i),h.updateChunk())}}else if(i>this._chunk.getChunkDepth()-1){const n=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(n){const r=parseInt(n[1]),a=parseInt(n[2]),h=c.getEntityByName(`Chunk[${r},${a+1}]`);h&&h.getBlocks()[e][s][0]!=0&&(h.mesh.createCube(e,s,0),h.updateChunk())}}else if(i<0){const n=this._chunk.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/);if(n){const r=parseInt(n[1]),a=parseInt(n[2]),h=c.getEntityByName(`Chunk[${r},${a-1}]`);h&&h.getBlocks()[e][s][this._chunk.getChunkDepth()-1]!=0&&(h.mesh.createCube(e,s,this._chunk.getChunkDepth()-1),h.updateChunk())}}else this.createCube(e,s,i)}addBlock(t,e,s=!1){t=[Math.floor(t[0]+.5),Math.floor(t[1]+.5),Math.floor(t[2]+.5)];let[i,n,r]=t;if(i=(i%16+16)%16,r=(r%16+16)%16,this.hasBlock(i,n,r)){if(s){this.removeBlock(t),e!=0&&this.addBlock(t,e);return}}else{const a=c.getEntityByName("Player");if(e!=null?this._chunk.getBlocks()[i][n][r]=e:this._chunk.getBlocks()[i][n][r]=a.toolbar.currentItem.value,i==this._chunk.getChunkWidth()-1){const h=this._chunk.getNameId().match(/\[(-?\d+),(-?\d+)\]/);if(h){const u=parseInt(h[1]),d=parseInt(h[2]),m=c.getEntityByName(`Chunk[${u+1},${d}]`);m&&m.getBlocks()[0][n]&&m.getBlocks()[0][n][r]!=0&&m.mesh.removeBlockMeshAndAdd([i+1,n,r])}}else this.removeBlockMeshAndAdd([i+1,n,r]);if(i==0){const h=this._chunk.getNameId().match(/\[(-?\d+),(-?\d+)\]/);if(h){const u=parseInt(h[1]),d=parseInt(h[2]),m=c.getEntityByName(`Chunk[${u-1},${d}]`);m&&m.getBlocks()[m.getChunkWidth()-1][n]&&m.getBlocks()[m.getChunkWidth()-1][n][r]!=0&&m.mesh.removeBlockMeshAndAdd([i-1,n,r])}}else this.removeBlockMeshAndAdd([i-1,n,r]);if(r==this._chunk.getChunkDepth()-1){const h=this._chunk.getNameId().match(/\[(-?\d+),(-?\d+)\]/);if(h){const u=parseInt(h[1]),d=parseInt(h[2]),m=c.getEntityByName(`Chunk[${u},${d+1}]`);m&&m.getBlocks()[i][n]&&m.getBlocks()[i][n][0]!=0&&m.mesh.removeBlockMeshAndAdd([i,n,r+1])}}else this.removeBlockMeshAndAdd([i,n,r+1]);if(r==0){const h=this._chunk.getNameId().match(/\[(-?\d+),(-?\d+)\]/);if(h){const u=parseInt(h[1]),d=parseInt(h[2]),m=c.getEntityByName(`Chunk[${u},${d-1}]`);m&&m.getBlocks()[i][n]&&m.getBlocks()[i][n][m.getChunkDepth()-1]!=0&&m.mesh.removeBlockMeshAndAdd([i,n,r-1])}}else this.removeBlockMeshAndAdd([i,n,r-1]);this.removeBlockMeshAndAdd([i,n+1,r]),this.removeBlockMeshAndAdd([i,n-1,r]),e!=0&&this.createCube(i,n,r)}this._chunk.updateChunk()}removeBlock(t){t=[Math.floor(t[0]+.5),Math.floor(t[1]+.5),Math.floor(t[2]+.5)];let[e,s,i]=t;e=(e%16+16)%16,i=(i%16+16)%16,this._chunk.getBlocks()[e][s][i]=0;for(let n=0;n<6;n++){const r=this.indexVertices[e][s][i][n];if(r!=null){this.emptyVertices.push(r);let a=this.getVertices();for(let h=0;h<12;h++)a[r/4+h]=0;l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferSubData(l.ARRAY_BUFFER,r,new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0])),this.indexVertices[e][s][i][n]=null}}this.addMeshBlock([e+1,s,i]),this.addMeshBlock([e-1,s,i]),this.addMeshBlock([e,s+1,i]),this.addMeshBlock([e,s-1,i]),this.addMeshBlock([e,s,i+1]),this.addMeshBlock([e,s,i-1]),this._chunk.updateChunk()}createFace(t,e,s,i){const n=this._chunk.getBlocks()[e][s][i],r=K[t],a=Jt(n)[r],h=4;if(this.emptyVertices.length>0){const u=this.emptyVertices.pop();if(u!=null){const d=[];let m=this.getVertices();for(let B=0;B<4;B++)d.push(V[t*12+B*3]+e),d.push(V[t*12+1+B*3]+s),d.push(V[t*12+2+B*3]+i),m[u/4+B*3]=V[t*12+B*3]+e,m[u/4+B*3+1]=V[t*12+1+B*3]+s,m[u/4+B*3+2]=V[t*12+2+B*3]+i;this.indexVertices[e][s][i][t]=u,l.bindBuffer(l.ARRAY_BUFFER,this.getVertexBuffer()),l.bufferSubData(l.ARRAY_BUFFER,u,new Float32Array(d));const f=u/h/3*2*h,y=[];let k=this.getUVs();const E=this.textureAtlas.getUVs(a);y.push(E[0],E[5]),y.push(E[2],E[7]),y.push(E[4],E[1]),y.push(E[6],E[3]);const b=f/h;for(let B=0;B<8;B++)k[b+B]=y[B];l.bindBuffer(l.ARRAY_BUFFER,this.getUvBuffer()),l.bufferSubData(l.ARRAY_BUFFER,f,new Float32Array(y));const w=u/h/3*1*h,R=It[t],v=[];let L=this.getBrightness();v.push(R),v.push(R),v.push(R),v.push(R);const T=w/h;for(let B=0;B<4;B++)L[T+B]=v[B];l.bindBuffer(l.ARRAY_BUFFER,this.getBrightnessBuffer()),l.bufferSubData(l.ARRAY_BUFFER,w,new Float32Array(v))}}else{this.indexVertices[e][s][i][t]=this.vertices.length*h;for(let m=0;m<4;m++)this.vertices.push(V[t*12+m*3]+e),this.vertices.push(V[t*12+1+m*3]+s),this.vertices.push(V[t*12+2+m*3]+i);this.indices.push(this.currentIndice+0),this.indices.push(this.currentIndice+1),this.indices.push(this.currentIndice+2),this.indices.push(this.currentIndice+1),this.indices.push(this.currentIndice+3),this.indices.push(this.currentIndice+2);const u=this.textureAtlas.getUVs(a);this.uvs.push(u[0],u[5]),this.uvs.push(u[2],u[7]),this.uvs.push(u[4],u[1]),this.uvs.push(u[6],u[3]);const d=It[t];this.brightness.push(d),this.brightness.push(d),this.brightness.push(d),this.brightness.push(d),this.currentIndice+=4}}init(){this.vertices.length&&(this.vertexBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.vertices),l.STATIC_DRAW),this.uvBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.uvs),l.STATIC_DRAW),this.brightnessBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.brightness),l.STATIC_DRAW),this.indexBuffer=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),l.STATIC_DRAW))}getVertices(){return this.vertices}setVertices(t){this.vertices=t}getIndices(){return this.indices}getUVs(){return this.uvs}getBrightness(){return this.brightness}render(t){if(!this.vertexBuffer||!t.getVisible())return;this.shader.use();const e=t.getModel(),s=this.shader.getAttribLocation("aPosition"),i=this.shader.getUniformLocation("uModel");if(mt(e),X(e,e,t.position),t.getHandItem()){const u=c.getEntityByName("HandItemTool").getSwayOffset();it(e,e,u[0]),t.getRotate90()?(ht(e,e,90*(Math.PI/180)),pt(e,e,50*(Math.PI/180))):it(e,e,-50*(Math.PI/180)),at(e,e,t.scale);let d=q();xt(d,c.getEntityByName("Player").getCamera().getViewMatrix()),St(e,d,e)}else at(e,e,t.scale);l.uniformMatrix4fv(i,!1,e),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(s),l.vertexAttribPointer(s,this.shader.isPositionVec3?3:2,l.FLOAT,!1,0,0),dt().bind(0);const r=this.shader.getAttribLocation("aTexCoord");l.bindBuffer(l.ARRAY_BUFFER,this.uvBuffer),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,2,l.FLOAT,!1,0,0);const a=this.shader.getAttribLocation("aBrightness");l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.enableVertexAttribArray(a),l.vertexAttribPointer(a,1,l.FLOAT,!1,0,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawLinesInsteadTriangles?l.drawElements(l.LINES,this.indices.length,l.UNSIGNED_SHORT,0):l.drawElements(l.TRIANGLES,this.indices.length,l.UNSIGNED_SHORT,0)}}const yt=[-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5];class bt{constructor(t,e,s,i=16){this.itemIndexInTextureAtlas=s,this.tileSize=i,this.colors=[],this.brightness=[],this.currentIndice=0,this.textureAtlas=new Nt(dt(),16),this.colorBuffer=null,this.brightnessBuffer=null,this.drawLinesInsteadTriangles=!1,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=[],this.indices=[],this.indexVertices=t,this.shader=e}generateMeshData(){for(let t=0;t<this.tileSize;t++)for(let e=0;e<1;e++)for(let s=0;s<this.tileSize;s++)this.textureAtlas.getPixelColor(t,s,this.itemIndexInTextureAtlas).a>0&&this.createCube(t,e,s);this.init()}updateBuffers(){l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.vertices),l.DYNAMIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.colors),l.DYNAMIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.brightness),l.DYNAMIC_DRAW),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),l.DYNAMIC_DRAW)}getShader(){return this.shader}render(t){if(!this.vertexBuffer||!t.getVisible())return;this.shader.use();const e=t.getModel(),s=this.shader.getAttribLocation("aPosition"),i=this.shader.getUniformLocation("uModel");if(mt(e),X(e,e,t.position),t.getHandItem()){const h=c.getEntityByName("HandItemTool"),u=h.getSwayOffset();if(it(e,e,u[0]),h.isBreaking()){const m=c.getEntityByName("Player"),f=h.getBreakingPhase();if(m.toolbar.currentItem.value==A.SHOVEL||m.toolbar.currentItem.value==A.GOLDENSHOVEL)X(e,e,[0,-.05,-.05*f]),ht(e,e,-90*(Math.PI/180));else if(m.toolbar.currentItem.value==A.PICKAXE||m.toolbar.currentItem.value==A.GOLDENPICKAXE){const k=.02*Math.abs(f);it(e,e,50),X(e,e,[0,-.01-k,.1*f])}}t.getRotate90()?(ht(e,e,90*(Math.PI/180)),pt(e,e,50*(Math.PI/180))):it(e,e,-50*(Math.PI/180)),at(e,e,t.scale);let d=q();xt(d,c.getEntityByName("Player").getCamera().getViewMatrix()),St(e,d,e)}else{at(e,e,t.scale),t.getRotate90()&&ht(e,e,90*(Math.PI/180)),X(e,e,[8,0,0]);const m=performance.now()/1e3*1.5;pt(e,e,m),X(e,e,[-8,0,0])}l.uniformMatrix4fv(i,!1,e),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(s),l.vertexAttribPointer(s,this.shader.isPositionVec3?3:2,l.FLOAT,!1,0,0),dt().bind(0);const r=this.shader.getAttribLocation("aColor");l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,3,l.FLOAT,!1,0,0);const a=this.shader.getAttribLocation("aBrightness");l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.enableVertexAttribArray(a),l.vertexAttribPointer(a,1,l.FLOAT,!1,0,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawLinesInsteadTriangles?l.drawElements(l.LINES,this.indices.length,l.UNSIGNED_SHORT,0):l.drawElements(l.TRIANGLES,this.indices.length,l.UNSIGNED_SHORT,0)}init(){this.vertices.length&&(this.vertexBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.vertices),l.STATIC_DRAW),this.colorBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.colors),l.STATIC_DRAW),this.brightnessBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.brightnessBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.brightness),l.STATIC_DRAW),this.indexBuffer=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),l.STATIC_DRAW))}createCube(t,e,s){(this.textureAtlas.getPixelColor(t,s+1,this.itemIndexInTextureAtlas).a==0||s==this.tileSize-1)&&this.createFace(K.FRONT,t,e,s),(this.textureAtlas.getPixelColor(t,s-1,this.itemIndexInTextureAtlas).a==0||s==0)&&this.createFace(K.BACK,t,e,s),this.hasBlock(t,e+1,s)||this.createFace(K.TOP,t,e,s),this.hasBlock(t,e-1,s)||this.createFace(K.BOTTOM,t,e,s),this.textureAtlas.getPixelColor(t-1,s,this.itemIndexInTextureAtlas).a==0&&this.createFace(K.LEFT,t,e,s),(t==this.tileSize-1||this.textureAtlas.getPixelColor(t+1,s,this.itemIndexInTextureAtlas).a==0)&&this.createFace(K.RIGHT,t,e,s)}hasBlock(t,e,s){return t<0||t>=this.tileSize||e<0||e>=1||s<0||s>=this.tileSize?0:this.textureAtlas.getPixelColor(t,s,this.itemIndexInTextureAtlas).a!=0}createFace(t,e,s,i){const n=this.textureAtlas.getPixelColor(e,i,this.itemIndexInTextureAtlas);for(let a=0;a<4;a++)this.vertices.push(yt[t*12+a*3]+e),this.vertices.push(yt[t*12+1+a*3]+s),this.vertices.push(yt[t*12+2+a*3]+i);this.indices.push(this.currentIndice+0),this.indices.push(this.currentIndice+1),this.indices.push(this.currentIndice+2),this.indices.push(this.currentIndice+1),this.indices.push(this.currentIndice+3),this.indices.push(this.currentIndice+2),this.colors.push(n.r/255,n.g/255,n.b/255),this.colors.push(n.r/255,n.g/255,n.b/255),this.colors.push(n.r/255,n.g/255,n.b/255),this.colors.push(n.r/255,n.g/255,n.b/255);const r=It[t];this.brightness.push(r),this.brightness.push(r),this.brightness.push(r),this.brightness.push(r),this.currentIndice+=4}getVertices(){return this.vertices}getIndices(){return this.indices}getColors(){return this.colors}getBrightness(){return this.brightness}}class gt{constructor(t,e){this.isPositionVec3=!1,this.hasTexCoord=!1,this.hasColor=!1,this.hasBrightness=!1;const s=this.compileShader(l.VERTEX_SHADER,t),i=this.compileShader(l.FRAGMENT_SHADER,e);if(this.program=l.createProgram(),l.attachShader(this.program,s),l.attachShader(this.program,i),l.linkProgram(this.program),!l.getProgramParameter(this.program,l.LINK_STATUS)){const n=l.getProgramInfoLog(this.program);throw new Error(`Shader program linking failed:
`+n)}this.detectPositionAttributeType(t),this.detectTexCoordAttribute(t),this.detectColorsAttribute(t),this.detectBrightnessAttribute(t)}detectPositionAttributeType(t){const e=/attribute\s+vec(\d)\s+aPosition/,s=t.match(e);s&&(this.isPositionVec3=s[1]==="3")}detectTexCoordAttribute(t){const e=/attribute\s+vec2\s+aTexCoord/;this.hasTexCoord=e.test(t)}detectColorsAttribute(t){const e=/attribute\s+vec3\s+aColor/;this.hasColor=e.test(t)}detectBrightnessAttribute(t){const e=/attribute\s+float\s+aBrightness/;this.hasBrightness=e.test(t)}compileShader(t,e){const s=l.createShader(t);if(l.shaderSource(s,e),l.compileShader(s),!l.getShaderParameter(s,l.COMPILE_STATUS)){const i=l.getShaderInfoLog(s);throw new Error(`Shader compile error (${t===l.VERTEX_SHADER?"VERTEX":"FRAGMENT"}):
${i}`)}return s}use(){l.useProgram(this.program)}getAttribLocation(t){return l.getAttribLocation(this.program,t)}getUniformLocation(t){const e=l.getUniformLocation(this.program,t);return e}getProgram(){return this.program}}const qt=`
attribute vec3 aPosition;
attribute vec3 aColor;
attribute float aBrightness;

uniform mat4 uModel;
uniform mat4 uView;
uniform mat4 uProjection;

varying vec3 vColor;
varying float vBrightness;

void main() {
    vColor = aColor;
    vBrightness = aBrightness;
    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);
}
`,zt=`
precision mediump float;

varying vec3 vColor;
varying float vBrightness;

void main() {
    vec4 color = vec4(vColor, 1.0);
    gl_FragColor = vec4(color.rgb * vBrightness, color.a);
}
`,vt=new gt(qt,zt);class z{constructor(t,e,s,i,n){this.min=U(),this.max=U(),this.collisionPoints=[],this.blocksCollidedInfo=[],this.min=this.oldMin=t,this.max=this.oldMax=e,this.width=s,this.depth=i,this.height=n}generateFeetToHeadCollisionPoints(){let t=this.width*2,e=this.depth*2,s=this.height,i=.5,n=.5,r=.5;this.width<.5&&(i=t),this.depth<.5&&(n=e),this.collisionPoints.push([[0,-.2,-.2],["z"]]),this.collisionPoints.push([[0,-.2,this.depth+.2],["z"]]),this.collisionPoints.push([[this.width+.2,-.2,0],["x"]]),this.collisionPoints.push([[-.2,-.2,0],["x"]]);for(let a=0;a<=t;a+=i)for(let h=0;h<=e;h+=n)for(let u=0;u<=s;u+=r)if(u+.1>s-.5&&(u=s-.1),a==0||a==t||h==0||h==e){let d=[];a>0&&h==0&&a!=t?d=["z"]:a==0&&h>0&&h!=e?d=["x"]:a>0&&h==e&&a!=t?d=["z"]:a==t&&h>0&&h!=e?d=["x"]:d=["x","z"],this.collisionPoints.push([[a*i,u+.1,h*n],d])}}generateCollisionPoints(){let t=this.width*2,e=this.depth*2,s=.5,i=.5;this.width<.5&&(s=t),this.depth<.5&&(i=e);for(let n=0;n<=t;n+=s)for(let r=0;r<=e;r+=i)this.collisionPoints.push([[n*s,-.2,r*i],["y"]]),this.collisionPoints.push([[n*s,1.9,r*i],["y"]]);this.generateFeetToHeadCollisionPoints()}checkAndResolveCollision(t){for(let e=0;e<this.blocksCollidedInfo.length;e++)this.blocksCollidedInfo[e].axis[0]==t&&(t=="y"?(this.min[1]=this.blocksCollidedInfo[e].auxMin[0][1],this.max[1]=this.blocksCollidedInfo[e].auxMax[0][1]):t=="x"?(this.min[0]=this.blocksCollidedInfo[e].auxMin[0][0],this.max[0]=this.blocksCollidedInfo[e].auxMax[0][0]):t=="z"&&(this.min[2]=this.blocksCollidedInfo[e].auxMin[0][2],this.max[2]=this.blocksCollidedInfo[e].auxMax[0][2]));this.blocksCollidedInfo=[]}getBlocksCollidedInfo(){for(let t=0;t<this.collisionPoints.length;t++)this.getBlocksCollidedInfoIfCollided(this.collisionPoints[t])}getBlocksCollidedInfoIfCollided(t){const s=c.getEntityByName("Player").getPhysics().collideWithBlocks(t),i=t[1];for(let n=0;n<i.length;n++)i[n]=="y"?this.blocksCollidedInfo.push(s):i[n]=="x"?this.blocksCollidedInfo.push(s):i[n]=="z"&&this.blocksCollidedInfo.push(s)}getPositionFromAABB(t){return t?[this.min[0]+t[0],this.min[1]+t[1],this.min[2]+t[2]]:[this.min[0]+this.width/2,this.min[1]+this.height,this.min[2]+this.depth/2]}updatePosition(t,e){this.oldMin=N(this.min),this.oldMax=N(this.max),e==="y"?this.max[1]-=t[1]:e==="x"?this.min[0]+=t[0]:e==="z"&&(this.min[2]+=t[2]),this.max[2]=this.min[2]+this.depth,this.max[0]=this.min[0]+this.width,this.min[1]=this.max[1]-this.height}intersects(t){return this.min[0]<t.max[0]&&this.max[0]>t.min[0]&&this.min[1]<t.max[1]&&this.max[1]>t.min[1]&&this.min[2]<t.max[2]&&this.max[2]>t.min[2]}collide(t,e){let s={auxMin:[],auxMax:[],axis:[]};if(!this.intersects(t))return s;for(let i=0;i<e.length;i++)e[i]=="y"&&(this.min[1]<=t.max[1]&&this.oldMin[1]>t.max[1]?s=this.setBottom(s,t.max[1]+.001):this.max[1]>=t.min[1]-.18&&this.oldMax[1]<t.min[1]&&(s=this.setTop(s,t.min[1]-.18-.001))),e[i]=="x"&&(this.max[0]>=t.min[0]&&this.oldMax[0]<t.min[0]?s=this.setRight(s,t.min[0]-.001):this.min[0]<=t.max[0]&&this.oldMin[0]>t.max[0]&&(s=this.setLeft(s,t.max[0]+.001))),e[i]=="z"&&(this.min[2]<=t.max[2]&&this.oldMin[2]>t.max[2]?s=this.setFront(s,t.max[2]+.001):this.max[2]>=t.min[2]&&this.oldMax[2]<t.min[2]&&(s=this.setBack(s,t.min[2]-.001)));return s}setTop(t,e){const i=c.getEntityByName("Player").getPhysics();i.setVelocity([i.getVelocity()[0],0,i.getVelocity()[2]]);const n=N(this.min),r=N(this.max);return n[1]=e-this.height,r[1]=e,t.axis.push("y"),t.auxMin.push(n),t.auxMax.push(r),t}setRight(t,e){const s=N(this.min),i=N(this.max);return s[0]=e-this.width,i[0]=e,t.axis.push("x"),t.auxMin.push(s),t.auxMax.push(i),t}setLeft(t,e){const s=N(this.min),i=N(this.max);return s[0]=e,i[0]=e+this.width,t.axis.push("x"),t.auxMin.push(s),t.auxMax.push(i),t}setBack(t,e){const s=N(this.min),i=N(this.max);return s[2]=e-this.depth,i[2]=e,t.axis.push("z"),t.auxMin.push(s),t.auxMax.push(i),t}setFront(t,e){const s=N(this.min),i=N(this.max);return s[2]=e,i[2]=e+this.depth,t.axis.push("z"),t.auxMin.push(s),t.auxMax.push(i),t}setBottom(t,e){const i=c.getEntityByName("Player").getPhysics();i.getIsOnGround(),i.setIsOnGround(!0),i.setVelocity([i.getVelocity()[0],0,i.getVelocity()[2]]);const n=N(this.min),r=N(this.max);return n[1]=e,r[1]=e+this.height,t.axis.push("y"),t.auxMin.push(n),t.auxMax.push(r),t}}var H=(o=>(o[o.TOOL=0]="TOOL",o[o.BLOCK=1]="BLOCK",o))(H||{});class Zt{constructor(){this.textureAtlas=new Image,this.blocksImage=new Image,this._meshesPooling=new Map,this._eraseToolbarFlag=!1,c.SCENENAME=="Level1"?(this.slot1={value:A.SHOVEL,source:0,quantity:1,htmlElement:document.getElementById("slot1")},this.slot2={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot2")}):c.SCENENAME=="Level2"?(this.slot1={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot1")},this.slot2={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot2")}):c.SCENENAME=="Level3"?(this.slot1={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot1")},this.slot2={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot2")}):(this.slot1={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot1")},this.slot2={value:g.AIR,source:1,quantity:0,htmlElement:document.getElementById("slot2")}),this.slots=[this.slot1,this.slot2],this._currentItem=this.slot1,this.createToolMeshOfAllSlots(),this._eraseToolbarFlag=!0}get eraseToolbarFlag(){return this._eraseToolbarFlag}set eraseToolbarFlag(t){this._eraseToolbarFlag=t}eraseToolbar(){this._eraseToolbarFlag&&(this._eraseToolbarFlag=!1,this.removeItem(2),this.removeItem(1))}getCurrentSlotPosition(){for(let t=0;t<this.slots.length;t++)if(this.slots[t]===this.currentItem)return t+1;return 0}removeCurrentItem(){this.currentItem.quantity--,this.setSlotImage(this.currentItem)}addItem(t,e,s,i,n){this._eraseToolbarFlag=!0;let r=!1;if(n){for(let a=0;a<this.slots.length;a++)if(this.slots[a]==this.currentItem&&this.slots[a].value==g.AIR){r=!0,this.slots[a].value=t,this.slots[a].source=e,s||i&&s?this.slots[a].quantity=s:this.slots[a].quantity=1,this.setSlotImage(this.slots[a]),!this.meshesPooling.has(t)&&e==0&&this.meshesPooling.set(t,this.createToolMesh(a+1)),this.slots[a]==this.currentItem&&this.highlightSlot(a+1);return}if(!r){for(let a=0;a<this.slots.length;a++)if(this.slots[a].value==g.AIR){this.slots[a].value=t,this.slots[a].source=e,s||i&&s?this.slots[a].quantity=s:this.slots[a].quantity=1,this.setSlotImage(this.slots[a]),!this.meshesPooling.has(t)&&e==0&&this.meshesPooling.set(t,this.createToolMesh(a+1)),this.slots[a]==this.currentItem&&this.highlightSlot(a+1);return}}}for(let a=0;a<this.slots.length;a++)if(this.slots[a].value==g.AIR&&!i||i&&this.slots[a]==this.currentItem){this.slots[a].value=t,this.slots[a].source=e,s||i&&s?this.slots[a].quantity=s:this.slots[a].quantity=1,this.setSlotImage(this.slots[a]),!this.meshesPooling.has(t)&&e==0&&this.meshesPooling.set(t,this.createToolMesh(a+1)),this.slots[a]==this.currentItem&&this.highlightSlot(a+1);return}else if(this.slots[a].value==t&&this.slots[a].source==e){this.slots[a].quantity++,this.setSlotImage(this.slots[a]);return}}removeItem(t){const e=this.slots[t-1];e.value=g.AIR,e.source=1,e.quantity=0,this.setSlotImage(e),this.highlightSlot(t)}createToolMesh(t){const s=[];for(let n=0;n<16;n++){s[n]=[];for(let r=0;r<16;r++){s[n][r]=[];for(let a=0;a<16;a++)s[n][r][a]=[null,null,null,null,null,null]}}const i=new bt(s,vt,this.slots[t-1].value);return i.generateMeshData(),i}createToolMeshOfAllSlots(){for(let t=0;t<this.slots.length;t++)this.slots[t].source==0&&this.meshesPooling.set(this.slots[t].value,this.createToolMesh(t+1))}get meshesPooling(){return this._meshesPooling}set meshesPooling(t){this._meshesPooling=t}nextItem(){const e=(this.slots.indexOf(this._currentItem)+1)%this.slots.length;this.currentItem=this.slots[e],this.highlightSlot(e+1)}get currentItem(){return this._currentItem}set currentItem(t){this._currentItem=t}setSlotImage(t){const e=t.htmlElement,s=e.getElementsByClassName("quantity")[0];if(t.quantity>1?s.innerHTML=t.quantity.toString():t.quantity==1?s.innerHTML="":t.quantity==0&&(s.innerHTML="",t.value=g.AIR,t.source=1,c.getEntityByName("HandItemCube").mesh.removeBlock([0,0,0])),t.source==0)e.style.backgroundImage=`url('${this.textureAtlas.src}')`,e.style.backgroundSize="1700% 1600%",e.style.backgroundPosition=`${t.value%16*(100/15)}% ${Math.floor(t.value/16)*(100/15)}%`;else if(t.source==1){const i=t.value,n=Object.keys(g).length/2,r=i/(n-1)*100;e.style.backgroundImage=`url('${this.blocksImage.src}')`,e.style.backgroundSize=`${n*100}% 100%`,e.style.backgroundPosition=`${r}% 0%`}}async loadImages(){await this.loadImage(this.textureAtlas,"img/textureAtlasTransparent.png"),await this.loadImage(this.blocksImage,"img/blocksimage.png"),this.setSlotImage(this.slot1),this.setSlotImage(this.slot2)}loadImage(t,e){return new Promise((s,i)=>{t.onload=()=>s(),t.onerror=()=>i(new Error(`Erro ao carregar imagem: ${e}`)),t.src=e})}highlightSlot(t){c.getEntityByName("HandItemTool").stopBreaking();const s=this.slots[t-1],i=this.slot1.htmlElement,n=this.slot2.htmlElement;i.classList.remove("active"),n.classList.remove("active"),this.triggerSlot(s,t),s.htmlElement.classList.add("active")}triggerSlot(t,e){this._currentItem=t,t.source==1?(c.getEntityByName("HandItemTool").setVisible(!1),c.getEntityByName("HandItemCube").mesh.removeBlock([0,0,0]),c.getEntityByName("HandItemCube").mesh.addBlock([0,0,0],t.value),c.getEntityByName("HandItemCube").updateChunk(),c.getEntityByName("HandItemCube").setVisible(!0)):t.source==0&&(c.getEntityByName("HandItemTool").mesh=this.meshesPooling.get(t.value),c.getEntityByName("HandItemTool").setVisible(!0),c.getEntityByName("HandItemCube").setVisible(!1))}async init(){await this.loadImages()}}const Ct=class Ct{static loadSound(t,e){const s=new Audio(e);this.sounds.set(t,s),this.setVolume(t,.5)}static play(t){const e=this.sounds.get(t);e?(e.currentTime=0,e.play()):console.warn(`Sound "${t}" not found.`)}static stop(t){const e=this.sounds.get(t);e&&(e.pause(),e.currentTime=0)}static setVolume(t,e){const s=this.sounds.get(t);s&&(s.volume=Math.min(1,Math.max(0,e)))}static isLoaded(t){return this.sounds.has(t)}};Ct.sounds=new Map;let x=Ct;var A=(o=>(o[o.SHOVEL=16]="SHOVEL",o[o.PENCIL=17]="PENCIL",o[o.PICKAXE=18]="PICKAXE",o[o.GOLDENSHOVEL=19]="GOLDENSHOVEL",o[o.GOLDENPICKAXE=48]="GOLDENPICKAXE",o))(A||{});class D extends lt{constructor(t,e=16){const{nameId:s,handItem:i=!1,scale:n=[1,1,1],position:r=[0,0,0],tool:a=c.getEntityByName("Player").toolbar.currentItem.value,pickupItem:h=!1}=t,u=[];for(let m=0;m<e;m++){u[m]=[];for(let f=0;f<e;f++){u[m][f]=[];for(let y=0;y<e;y++)u[m][f][y]=[null,null,null,null,null,null]}}const d=new bt(u,vt,a);super(s,d),this.tileSize=e,this.swayOffset=U(),this.swayStrength=.05,this.breakingSpeed=3,this.collected=!1,this.pickupItem=!1,this.tool=a,this.position=[-.001,0,-.1],this.handItem=i,this.scale=n,this.pickupItem=h,i?this.scale=[.004,.004,.004]:(this.rotate90=!0,this.position=r,d.generateMeshData(),c.getEntityByName("Player").toolbar.meshesPooling.set(a,d)),this.breakingTime=0,this.breakingDuration=1,this.isBreakingState=!1}startBreaking(){this.isBreakingState=!0,this.breakingTime=0}stopBreaking(){c.getEntityByName("Player").stopBreaking(),this.isBreakingState=!1}updateBreakingAnimation(t){this.isBreakingState&&(this.breakingTime+=t*this.breakingSpeed,this.breakingTime>=this.breakingDuration&&(this.breakingTime=0))}getBreakingPhase(){if(this.isBreakingState){const t=this.breakingTime/this.breakingDuration;return Math.sin(t*Math.PI*2)}else return 0}isBreaking(){return this.isBreakingState}updateWholeTool(){const t=[];for(let e=0;e<this.tileSize;e++){t[e]=[];for(let s=0;s<this.tileSize;s++){t[e][s]=[];for(let i=0;i<this.tileSize;i++)t[e][s][i]=[null,null,null,null,null,null]}}this.mesh=new bt(t,vt,c.getEntityByName("Player").toolbar.currentItem.value),this.mesh.generateMeshData()}update(t,e){const s=c.getEntityByName("Player");if(!s.toolbar.eraseToolbarFlag&&this.pickupItem&&(this.visible=!0,this.collected=!1),!(!this.handItem&&this.collected))if(this.handItem){const i=c.getEntityByName("Player").getCamera(),n=i.getYaw(),a=-(n-(i.getLastYaw()??n))*this.swayStrength;this.swayOffset[0]+=(a-this.swayOffset[0])*.1,i.setLastYaw(n)}else{const i=[Math.floor(this.position[0]+.5),Math.floor(this.position[1]+.5),Math.floor(this.position[2]+.5)];let n=Math.floor(i[0]+.5);const r=Math.floor(i[1]+.5);let a=Math.floor(i[2]+.5);const h=Math.floor(n/16),u=Math.floor(a/16),d=c.getEntityByName(`Chunk[${h},${u}]`);if(d&&r>-1&&r<d.getChunkHeight()){const m=[n,r,a],f=new z([m[0]-.5,m[1]-.5,m[2]-.5],[m[0]+.5,m[1]-1,m[2]+.5],1,1,1);s.getPhysics().aabb.intersects(f)&&(x.play("collect"),this.collected=!0,s.toolbar.addItem(this.tool,H.TOOL,1,!1,!0),this.visible=!1)}}}getSwayOffset(){return this.swayOffset}}class ct{constructor(t){this.element=t,this.startCallbacks=[],this.moveCallbacks=[],this.endCallbacks=[],this.handleTouchStart=e=>{I.MENUON||e.preventDefault();for(let s of e.changedTouches)this.startCallbacks.forEach(i=>i(s))},this.handleTouchMove=e=>{for(let s of e.changedTouches)this.moveCallbacks.forEach(i=>i(s))},this.handleTouchEnd=e=>{for(let s of e.changedTouches)this.endCallbacks.forEach(i=>i(s))},this.element.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.handleTouchEnd,{passive:!1}),this.element.addEventListener("touchcancel",this.handleTouchEnd,{passive:!1})}onStart(t){this.startCallbacks.push(t)}onMove(t){this.moveCallbacks.push(t)}onEnd(t){this.endCallbacks.push(t)}destroy(){this.element.removeEventListener("touchstart",this.handleTouchStart),this.element.removeEventListener("touchmove",this.handleTouchMove),this.element.removeEventListener("touchend",this.handleTouchEnd),this.element.removeEventListener("touchcancel",this.handleTouchEnd)}}class Qt{constructor(){this.position=U(),this.front=$(0,0,-1),this.up=$(0,1,0),this.right=U(),this.yaw=-90,this.pitch=0,this.lastYaw=-90,this.lastPitch=0,this._sensitivity=.2,this.lastTouchX=0,this.lastTouchY=0,this.isTouching=!1,this.touchLookId=null,this._ignoreNextClick=!1,this._onMouseDown=e=>{const i=document.querySelector(".mobileButtonBackground").getBoundingClientRect();e.clientX>=i.left&&e.clientX<=i.right&&e.clientY>=i.top&&e.clientY<=i.bottom&&(this._ignoreNextClick=!0)},this._onMouseUp=e=>{const s=document.querySelector(".mobileButtonBackground"),i=document.querySelector("canvas"),n=s.getBoundingClientRect(),r=e.clientX>=n.left&&e.clientX<=n.right&&e.clientY>=n.top&&e.clientY<=n.bottom;if(this._ignoreNextClick||r){this._ignoreNextClick=!1;return}const a=document.getElementById("hud");a&&(a.style.opacity="1"),I.MENUON=!1,I.GAMEPAUSED=!1,I.PLAYERPAUSED=!1,i.requestPointerLock()},this._onMouseMove=e=>{if(I.PLAYERPAUSED)return;const s=e.movementX,i=e.movementY;this.yaw+=s*this.sensitivity,this.pitch-=i*this.sensitivity,this.pitch=Math.max(-89,Math.min(89,this.pitch)),this.updateVectors()},this.updateVectors(),this.initMouseLook(),this.initTouchLook(),P.addEventListener("mousemove",this._onMouseMove);const t=localStorage.getItem("fabrirama_sensitivity");if(t!==null){const e=parseFloat(t);this.sensitivity=e}else this.sensitivity=.2}set sensitivity(t){this._sensitivity=t;const e=document.getElementById("sensitivity");e&&(e.value=t.toString(),localStorage.setItem("fabrirama_sensitivity",t.toString()))}get sensitivity(){return this._sensitivity}destroy(){const t=document.querySelector("canvas"),e=document.querySelector("#hud");!t||!e||(e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp),t.removeEventListener("mousemove",this._onMouseMove))}getPitch(){return this.pitch}getYaw(){return this.yaw}updateVectors(){const t=this.yaw*(Math.PI/180),e=this.pitch*(Math.PI/180),s=Math.cos(t)*Math.cos(e),i=Math.sin(e),n=Math.sin(t)*Math.cos(e);this.front=nt(U(),$(s,i,n)),Vt(this.right,this.front,this.up),nt(this.right,this.right)}get ignoreNextClick(){return this._ignoreNextClick}set ignoreNextClick(t){this._ignoreNextClick=t}getViewMatrix(){const t=Bt(U(),this.position,this.front);return Et(q(),this.position,t,this.up)}getDirectionVectors(){return{front:this.front,right:this.right,up:this.up}}initMouseLook(){const t=document.querySelector("canvas"),e=document.querySelector("#hud"),s=document.querySelector(".mobileButtonBackground");!t||!e||!s||(this._ignoreNextClick=!1,e.addEventListener("mousedown",this._onMouseDown),e.addEventListener("mouseup",this._onMouseUp))}initTouchLook(){const t=document.getElementById("hud"),e=document.querySelector(".mobileButtonBackground");this._touchManager=new ct(t);const s=i=>{const n=e.getBoundingClientRect();return i.clientX>=n.left&&i.clientX<=n.right&&i.clientY>=n.top&&i.clientY<=n.bottom};this._touchManager.onStart(i=>{const n=document.elementFromPoint(i.clientX,i.clientY);n!=null&&n.closest("#hitButton, #jumpButton")||!s(i)&&this.touchLookId===null&&(this.isTouching=!0,this.touchLookId=i.identifier,this.lastTouchX=i.clientX,this.lastTouchY=i.clientY)}),this._touchManager.onMove(i=>{if(!this.isTouching||this.touchLookId!==i.identifier)return;const n=i.clientX-this.lastTouchX,r=i.clientY-this.lastTouchY;this.yaw+=n*this.sensitivity*3,this.pitch-=r*this.sensitivity*3,this.pitch=Math.max(-89,Math.min(89,this.pitch)),this.lastTouchX=i.clientX,this.lastTouchY=i.clientY,this.updateVectors()}),this._touchManager.onEnd(i=>{this.touchLookId===i.identifier&&(this.isTouching=!1,this.touchLookId=null)})}setPosition(t){kt(this.position,t)}getLastYaw(){return this.lastYaw}getLastPitch(){return this.lastPitch}setLastYaw(t){this.lastYaw=t}get touchManager(){return this._touchManager}set touchManager(t){this._touchManager=t}}class te{constructor(){this.origin={x:0,y:0},this.delta={x:0,y:0},this.isDragging=!1,this.touchId=null,this.handleSlot1Click=()=>this.handleSlotClick(1),this.handleSlot2Click=()=>this.handleSlotClick(2),this.handleHitDownBound=()=>this.handleHitDown(),this.handleHitUpBound=()=>this.handleHitUp(),this.handleJumpDown=()=>M.pressJumpButton(),this.handleJumpUp=()=>M.releaseJumpButton(),this.handleHitDown=()=>{const n=c.getEntityByName("Player");n.getCamera().ignoreNextClick=!0,n.toolbar.currentItem.source==H.BLOCK?M.pressRightClick():M.pressLeftClick()},this.handleHitUp=()=>{c.getEntityByName("Player").toolbar.currentItem.source==H.TOOL?M.releaseLeftClick():M.releaseRightClick()},this.handleSlotClick=n=>{const r=c.getEntityByName("Player");r.getCamera().ignoreNextClick=!0,r.toolbar.highlightSlot(n)},this.onTouchStart=n=>{this.touchId===null&&(this.touchId=n.identifier,this.startDragging(n.clientX,n.clientY))},this.onTouchMove=n=>{!this.isDragging||this.touchId!==n.identifier||this.moveStick(n.clientX,n.clientY)},this.onTouchEnd=n=>{this.touchId===n.identifier&&(this.touchId=null,this.onEnd())},this.onMouseDown=n=>{n.preventDefault(),this.startDragging(n.clientX,n.clientY)},this.onMouseMove=n=>{this.isDragging&&this.moveStick(n.clientX,n.clientY)},this.onMouseUp=()=>{this.isDragging&&this.onEnd()},this.onEnd=()=>{this.isDragging=!1,this.delta.x=0,this.delta.y=0,this.stick.style.transform="translate(-50%, -50%)"},this.stick=document.querySelector(".mobileButtonStick"),this.background=document.querySelector(".mobileButtonBackground"),this._touchManager=new ct(this.background),this._touchManager.onStart(this.onTouchStart),this._touchManager.onMove(this.onTouchMove),this._touchManager.onEnd(this.onTouchEnd),this.background.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp);const t=document.getElementById("slot1"),e=document.getElementById("slot2"),s=document.getElementById("hitButton"),i=document.getElementById("jumpButton");t&&(t.addEventListener("mousedown",this.handleSlot1Click),t.addEventListener("touchstart",this.handleSlot1Click)),e&&(e.addEventListener("mousedown",this.handleSlot2Click),e.addEventListener("touchstart",this.handleSlot2Click)),s&&(this._touchManagerHitButton=new ct(s),this._touchManagerHitButton.onStart(this.handleHitDownBound),this._touchManagerHitButton.onEnd(this.handleHitUpBound),s.addEventListener("mousedown",this.handleHitDownBound),s.addEventListener("mouseup",this.handleHitUpBound)),i&&(this._touchManagerJumpButton=new ct(i),this._touchManagerJumpButton.onStart(this.handleJumpDown),this._touchManagerJumpButton.onEnd(this.handleJumpUp),i.addEventListener("mousedown",this.handleJumpDown),i.addEventListener("mouseup",this.handleJumpUp))}destroy(){this.onEnd(),this.touchManager.destroy(),this._touchManagerHitButton.destroy(),this._touchManagerJumpButton.destroy(),this.background.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp);const t=document.getElementById("slot1"),e=document.getElementById("slot2"),s=document.getElementById("hitButton"),i=document.getElementById("jumpButton");t&&(t.removeEventListener("mousedown",this.handleSlot1Click),t.removeEventListener("touchstart",this.handleSlot1Click)),e&&(e.removeEventListener("mousedown",this.handleSlot2Click),e.removeEventListener("touchstart",this.handleSlot2Click)),s&&(s.removeEventListener("mousedown",this.handleHitDownBound),s.removeEventListener("touchstart",this.handleHitDownBound),s.removeEventListener("mouseup",this.handleHitUpBound),s.removeEventListener("touchend",this.handleHitUpBound)),i&&(i.removeEventListener("mousedown",this.handleJumpDown),i.removeEventListener("touchstart",this.handleJumpDown),i.removeEventListener("mouseup",this.handleJumpUp),i.removeEventListener("touchend",this.handleJumpUp))}startDragging(t,e){const s=this.background.getBoundingClientRect();this.origin.x=t-s.left,this.origin.y=e-s.top,this.isDragging=!0}moveStick(t,e){const s=this.background.getBoundingClientRect(),i=t-s.left,n=e-s.top;this.delta.x=i-this.origin.x,this.delta.y=n-this.origin.y;const r=s.width/2,a=Math.hypot(this.delta.x,this.delta.y);if(a>r){const h=r/a;this.delta.x*=h,this.delta.y*=h}this.stick.style.transform=`translate(calc(-50% + ${this.delta.x}px), calc(-50% + ${this.delta.y}px))`}getDirection(){const e=this.background.getBoundingClientRect().width/2;return{x:this.delta.x/e,y:-this.delta.y/e}}isActive(){return this.isDragging}get touchManager(){return this._touchManager}set touchManager(t){this._touchManager=t}}class ee{constructor(t){this.gravity=-15.8,this.velocity=U(),this.isOnGround=!1;const e=.3,s=.3,i=1.7;this._aabb=new z($(t[0]-e,t[1]-i,t[2]-s),$(t[0]+e,t[1],t[2]+s),e,s,i),this._aabb.generateCollisionPoints()}resetVelocity(){this.setVelocity([this.velocity[0],0,this.velocity[2]])}getIsOnGround(){return this.isOnGround}setIsOnGround(t){this.isOnGround=t}setVelocity(t){this.velocity=t}getVelocity(){return this.velocity}update(t,e){const i=c.getEntityByName("Player").getFlyMode();return this.velocity[0]=t[0],i&&(this.velocity[1]=t[1]),this.velocity[2]=t[2],i?(this._aabb.updatePosition(this.velocity,"y"),this._aabb.updatePosition(this.velocity,"x"),this._aabb.updatePosition(this.velocity,"z")):(this.velocity[1]-=this.gravity*(e/60),this._aabb.updatePosition(this.velocity,"y"),this._aabb.getBlocksCollidedInfo(),this._aabb.checkAndResolveCollision("y"),this._aabb.updatePosition(this.velocity,"x"),this._aabb.getBlocksCollidedInfo(),this._aabb.checkAndResolveCollision("x"),this._aabb.updatePosition(this.velocity,"z"),this._aabb.getBlocksCollidedInfo(),this._aabb.checkAndResolveCollision("z")),this._aabb.getPositionFromAABB()}jump(){const t=c.getEntityByName("Player");(this.getIsOnGround()||t.coyoteTime>0)&&(t.playerOnTopOfGrassOrDirt,x.play("jump"),this.velocity[1]=-.1,this.setIsOnGround(!1),t.coyoteTime=0)}collideWithBlocks(t){const e=this._aabb.getPositionFromAABB(t[0]);let s={auxMin:[],auxMax:[],axis:[]};const i=this.checkBlockSolid(e);if(i!==null){const[n,r]=i,a=new z([n[0]-.5,n[1]-.5,n[2]-.5],[n[0]+.5,n[1]+.5,n[2]+.5],1,1,1);if(s=this._aabb.collide(a,t[1]),r==g.REDCUBE&&s.axis[0]=="y")c.getEntityByName("Player").toolbar.eraseToolbar();else if((r==g.DIRT||r==g.GRASS||r==g.LEAVES)&&s.axis[0]=="y"){const h=c.getEntityByName("Player");h.playerOnTopOfGrassOrDirt=!0}else if(r!=g.DIRT&&r!=g.GRASS&&r!=g.LEAVES&&s.axis[0]=="y"){const h=c.getEntityByName("Player");h.playerOnTopOfGrassOrDirt=!1}}return s}checkBlockSolid(t){let e=Math.floor(t[0]+.5);const s=Math.floor(t[1]+.5);let i=Math.floor(t[2]+.5);const n=Math.floor(e/16),r=Math.floor(i/16);let a=(e%16+16)%16,h=(i%16+16)%16;const u=c.getEntityByName(`Chunk[${n},${r}]`);return u&&s>-1&&s<u.getChunkHeight()&&a>-1&&a<u.getChunkWidth()&&h>-1&&h<16&&u.getBlocks()[a][s][h]!==0?[[e,s,i],u.getBlocks()[a][s][h]]:null}get aabb(){return this._aabb}set aabb(t){this._aabb=t}}class At{constructor(t,e,s,i){this.colorBuffer=null,this.colors=[],this.drawLinesInsteadTriangles=!1,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=t,this.indices=e,this.shader=s,this.colors=i,this.init()}init(){this.vertices.length&&(this.vertexBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.vertices),l.STATIC_DRAW),this.colorBuffer=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(this.colors),l.STATIC_DRAW),this.indexBuffer=l.createBuffer(),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),l.STATIC_DRAW))}render(t){if(!this.vertexBuffer||!t.getVisible())return;this.shader.use();const e=t.getModel(),s=this.shader.getAttribLocation("aPosition"),i=this.shader.getUniformLocation("uModel");mt(e),X(e,e,t.position),at(e,e,t.scale),l.uniformMatrix4fv(i,!1,e),l.bindBuffer(l.ARRAY_BUFFER,this.vertexBuffer),l.enableVertexAttribArray(s),l.vertexAttribPointer(s,this.shader.isPositionVec3?3:2,l.FLOAT,!1,0,0);const n=this.shader.getAttribLocation("aColor");l.bindBuffer(l.ARRAY_BUFFER,this.colorBuffer),l.enableVertexAttribArray(n),l.vertexAttribPointer(n,3,l.FLOAT,!1,0,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawLinesInsteadTriangles?l.drawElements(l.LINES,this.indices.length,l.UNSIGNED_SHORT,0):l.drawElements(l.TRIANGLES,this.indices.length,l.UNSIGNED_SHORT,0)}getShader(){return this.shader}updateBuffers(){throw new Error("Method not implemented.")}}const se=`
attribute vec3 aPosition;
attribute vec3 aColor;
uniform mat4 uModel;
uniform mat4 uView;
uniform mat4 uProjection;
varying vec3 vColor;
void main() {
    vColor = aColor;
    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);
}
`,ie=`
precision mediump float;
varying vec3 vColor;
void main() {
    gl_FragColor = vec4(vColor, 0.3);
}
`,Dt=new gt(se,ie);class ft{constructor(){this.outputDiv=document.getElementById("consoleOutput"),this.outputDiv.style.display="none",this.input=document.createElement("input"),this.input.style.width="100%",this.input.style.maxWidth="100%",this.input.style.boxSizing="border-box",this.input.style.background="black",this.input.style.color="white",this.input.style.border="none",this.input.style.outline="none",this.input.style.fontSize="1em",this.input.style.padding="0.5em",this.input.style.display="none",this.outputDiv.appendChild(this.input),this.overrideConsole(),this.setupEventListeners()}overrideConsole(){const t=(e,s)=>{const i=document.createElement("div");i.style.marginBottom="0.3em",e==="error"?i.style.color="red":e==="warn"?i.style.color="orange":i.style.color="white",i.textContent=`[${e}] ${s.join(" ")}`,this.outputDiv.insertBefore(i,this.input),this.outputDiv.scrollTop=this.outputDiv.scrollHeight};["log","error","warn","info","debug"].forEach(e=>{const s=console[e];console[e]=(...i)=>{s.apply(console,i),t(e,i)}})}setupEventListeners(){window.addEventListener("keydown",t=>{if(t.key.toLowerCase()==="t"&&this.outputDiv.style.display==="none")I.PLAYERPAUSED=!0,this.outputDiv.style.display="block",this.input.style.display="block",this.input.focus(),t.preventDefault();else if(t.key==="Enter"&&this.outputDiv.style.display==="block"){I.PLAYERPAUSED=!1;const e=this.input.value.trim();e.length>0&&(console.log(`Executing: ${e}`),ft.executeCommand(e)),this.input.value="",this.outputDiv.style.display="none",this.input.style.display="none",t.preventDefault()}})}static executeCommand(t){const e=t.split(" ");if(e[0]==="fill"){const s=e[1];let i;const n=Number(s);if(!isNaN(n)&&g[n]!==void 0)i=n;else if(s in g)i=g[s];else throw new Error(`Invalid value for block id: ${s}`);c.getEntityByName("WireframeChunk").fillBasedLength(i)}else if(e[0]==="set"&&e[1]){const s=e[1].toUpperCase(),i=c.getEntityByName("Player");if(e[1]=="pencil")i.toolbar.removeItem(i.toolbar.getCurrentSlotPosition()),i.toolbar.addItem(A.PENCIL,H.TOOL);else if(e[1]=="shovel")i.toolbar.removeItem(i.toolbar.getCurrentSlotPosition()),i.toolbar.addItem(A.SHOVEL,H.TOOL);else if(s in g){const n=g[s];i.toolbar.removeItem(i.toolbar.getCurrentSlotPosition()),i.toolbar.addItem(n,H.BLOCK,50)}else console.warn(`Unknown item: "${s}"`)}else if(t=="creative"){localStorage.setItem("fabrirama_creative","true");const s=c.getEntityByName("Player");s.creativeMode=!s.creativeMode}else t==="hello"?console.log("Hello world!"):t==="time"?console.log(`Current time: ${new Date().toLocaleTimeString()}`):console.warn(`Unknown command: "${t}"`)}}class W extends lt{constructor(t){const e=new At([-.5,-.5,.5,-.5,-.5,.5,.5,.5],[0,1,2,1,3,2],Dt,[1,0,0]);super("Player",e),this.speed=6,this.previousPosition=U(),this.currentPosition=U(),this.flyMode=!1,this.ctrlPressed=!1,this.previousOfCurrent=U(),this.breakStage=0,this.totalStages=6,this.interval=2e3/this.totalStages,this.breakingStartTime=0,this.breakingCubePosition=null,this.accumulatedTime=0,this.fixedStep=1/60,this._removeBlockImmediately=!1,this._creativeMode=!1,this._footstepTimer=0,this._footstepInterval=.4,this._hitGround=!1,this._firstTimeHitted=!1,this._playerOnTopOfGrassOrDirt=!1,this.COYOTE_TIME_MAX=.15,this.coyoteTime=0,this._wasOnGroundLastFrame=!1,this.jumpCooldownTimer=0,this.JUMP_COOLDOWN=.2,this.camera=new Qt;const s=this.camera.position;kt(this.previousPosition,s),kt(this.currentPosition,s),this._joystick=new te,this.physics=new ee(t),this._toolbar=new Zt}get playerOnTopOfGrassOrDirt(){return this._playerOnTopOfGrassOrDirt}set playerOnTopOfGrassOrDirt(t){this._playerOnTopOfGrassOrDirt=t}get creativeMode(){return this._creativeMode}set creativeMode(t){this._creativeMode=t}async initToolbar(){this._toolbar.init()}getCamera(){return this.camera}updateBreaking(t){if(!this.breakingCubePosition)return;const e=t-this.breakingStartTime,s=Math.floor(e/this.interval);if(s>=this.totalStages){const[i,n,r]=this.breakingCubePosition,a=Math.floor(i/16),h=Math.floor(r/16),u=(i%16+16)%16,d=(r%16+16)%16,m=c.getEntityByName(`Chunk[${a},${h}]`),f=c.getEntityByName("BreakingCube"),y=m.getBlocks()[u][n][d];m.mesh.removeBlock([u,n,d]),f.setVisible(!1),this._toolbar.addItem(y,H.BLOCK),this.breakingCubePosition=null,x.play("place");return}if(s!==this.breakStage){this._toolbar.currentItem.value==A.PICKAXE||this._toolbar.currentItem.value==A.GOLDENPICKAXE?x.play("pickaxe"):x.play("dig");const i=c.getEntityByName("BreakingCube");i.mesh.removeBlock([0,0,0]),i.mesh.addBlock([0,0,0],g.BREAK1+s),this.breakStage=s}}startBreaking(t,e){if(this.breakingCubePosition||!(this._toolbar.currentItem.source==H.TOOL&&(this._toolbar.currentItem.value==A.SHOVEL||this._toolbar.currentItem.value==A.GOLDENSHOVEL||this._toolbar.currentItem.value==A.PICKAXE||this._toolbar.currentItem.value==A.GOLDENPICKAXE)))return;const s=Math.floor(t[0]+.5),i=Math.floor(t[1]+.5),n=Math.floor(t[2]+.5),r=Math.floor(s/16),a=Math.floor(n/16),h=(s%16+16)%16,u=(n%16+16)%16,d=c.getEntityByName(`Chunk[${r},${a}]`);if(!d||d.getBlocks()[h][i][u]!=g.DIRT&&this._toolbar.currentItem.value==A.SHOVEL||d.getBlocks()[h][i][u]!=g.GRASS&&d.getBlocks()[h][i][u]!=g.DIRT&&this._toolbar.currentItem.value==A.GOLDENSHOVEL||d.getBlocks()[h][i][u]!=g.STONE&&(this._toolbar.currentItem.value==A.PICKAXE||this._toolbar.currentItem.value==A.GOLDENPICKAXE))return;c.getEntityByName("BreakingCube").setVisible(!0),this.breakingStartTime=e,this.breakStage=-1,c.getEntityByName("HandItemTool").startBreaking(),this.breakingCubePosition=[s,i,n]}stopBreaking(){const t=c.getEntityByName("BreakingCube");this.breakStage=0,t.setVisible(!1),t.mesh.removeBlock([0,0,0]),this.breakingCubePosition=null}raycastForward(t,e=.1,s){const i=N(this.camera.position),n=this.camera.getDirectionVectors().front,r=N(n);nt(r,r);const a=N([i[0],i[1],i[2]]);this.previousOfCurrent=N(a);let h=0,u=!1;const d=c.getEntityByName("OutlineCube"),m=c.getEntityByName("BreakingCube");if(!d)return null;let f=!1;for(M.isKeyPressed("f")&&this._creativeMode&&(f=!0);h<t;){if(this.physics.checkBlockSolid(a)){d.setVisible(!0),u=!0,d.position=[Math.floor(a[0]+.5),Math.floor(a[1]+.5),Math.floor(a[2]+.5)],m.position=[Math.floor(a[0]+.5),Math.floor(a[1]+.5),Math.floor(a[2]+.5)],M.isMouseButtonPressed(0)&&this.breakingCubePosition==null?this.startBreaking(d.position,s):this.breakingCubePosition&&!Wt(this.breakingCubePosition,d.position)&&this.stopBreaking();break}this.previousOfCurrent=N(a),st(a,a,r,e),h+=e}return!u&&d&&(d.setVisible(!1),this.stopBreaking()),f&&(d.setVisible(!0),u=!0,d.position=[Math.floor(a[0]+.5),Math.floor(a[1]+.5),Math.floor(a[2]+.5)]),null}getPhysics(){return this.physics}getFlyMode(){return this.flyMode}addOrRemoveBlock(t,e){const s=[Math.floor(t[0]+.5),Math.floor(t[1]+.5),Math.floor(t[2]+.5)],i=c.getEntityByName("Chunk");let n=g.AIR;if(e){const r=s[1],a=s[0];if(!(r>-1&&r<i.getChunkHeight()&&a>-1&&a<i.getChunkWidth()))return;n=g.GRASS}i.getBlocks()[s[0]][s[1]][s[2]]=n,i.updateChunk()}drawChunkBetweenPoints(t,e){let s=e[0]-t[0]+1,i=e[1]-t[1]+1,n=e[2]-t[2]+1,r=U();s<1?(r[0]=e[0],s=t[0]-e[0]+1):r[0]=t[0],i<1?(r[1]=e[1],i=t[1]-e[1]+1):r[1]=t[1],n<1?(r[2]=e[2],n=t[2]-e[2]+1):r[2]=t[2];const a=new p({nameId:"WireframeChunk",chunkWidth:s,chunkHeight:i,chunkDepth:n,block:g.LEAVES,scale:[1,1,1],createMeshNow:!0,drawLinesInsteadTriangles:!0,fillAll:!0});a.position=r,c.addEntity(a)}async update(t,e){if(M.wasKeyJustPressed("h")&&localStorage.getItem("fabrirama_creative")=="true"&&(this.creativeMode=!this.creativeMode),M.wasKeyJustPressed("p")&&this.creativeMode&&ft.executeCommand("set pencil"),M.wasKeyJustPressed("r")&&this.creativeMode&&(this._removeBlockImmediately=!this._removeBlockImmediately),this.camera.position[1]<-10){c.initLoadingBar(),P.style.opacity="0";const h=document.getElementById("hud");h&&(h.style.opacity="0"),I.GAMEPAUSED=!0,await c.waitNextFrame(),I.switchToAnotherLevel("Level"+c.LEVELNUMBER,c.LEVELNUMBER)}this.updateBreaking(t),I.PLAYERPAUSED||(M.wasKeyJustPressed("1")?this._toolbar.highlightSlot(1):M.wasKeyJustPressed("2")&&this._toolbar.highlightSlot(2),M.wasKeyJustPressed("g")&&console.log(`${this.camera.position[0]}, ${this.camera.position[1]},
        ${this.camera.position[2]}`));const s=c.getEntityByName("HandItemTool");s.updateBreakingAnimation(e);const i=c.getEntityByName("OutlineCube");if(M.wasKeyJustPressed("b")&&this.creativeMode&&i.getVisible()){const h=i.position,u=Math.floor(h[0]+.5),d=Math.floor(h[1]+.5),m=Math.floor(h[2]+.5),f=Math.floor(u/16),y=Math.floor(m/16),k=(u%16+16)%16,E=(m%16+16)%16,w=c.getEntityByName(`Chunk[${f},${y}]`).getBlocks()[k][d][E];c.getEntityByName("Player").toolbar.addItem(w,H.BLOCK,99,!0)}if(M.wasMouseJustReleased(0)&&this._toolbar.currentItem.source==H.TOOL&&(this._toolbar.currentItem.value==A.SHOVEL||this._toolbar.currentItem.value==A.GOLDENSHOVEL||this._toolbar.currentItem.value==A.PICKAXE||this._toolbar.currentItem.value==A.GOLDENPICKAXE)&&(this.stopBreaking(),s.stopBreaking()),M.wasMouseJustPressed(0)){const h=i.position,u=Math.floor(h[0]+.5),d=Math.floor(h[1]+.5),m=Math.floor(h[2]+.5),f=Math.floor(u/16),y=Math.floor(m/16),k=(u%16+16)%16,E=(m%16+16)%16,b=c.getEntityByName(`Chunk[${f},${y}]`);if(b&&d>-1&&d<b.getChunkHeight()&&this._removeBlockImmediately&&i&&i.getVisible()&&b.mesh.removeBlock([k,d,E]),this._toolbar.currentItem.source==H.TOOL){if(this._toolbar.currentItem.value==A.SHOVEL||this._toolbar.currentItem.value==A.GOLDENSHOVEL||this._toolbar.currentItem.value==A.PICKAXE||this._toolbar.currentItem.value==A.GOLDENPICKAXE)s.startBreaking();else if(this._toolbar.currentItem.value==A.PENCIL&&i&&i.getVisible()){const w=c.getEntityByName("GreenCube");w.position=i.position;const R=c.getEntityByName("RedCube");this.drawChunkBetweenPoints(w.position,R.position)}}}if(i&&i.getVisible()){if(M.wasMouseJustPressed(2)&&this._toolbar.currentItem.source==H.BLOCK&&this._toolbar.currentItem.value!=g.AIR){const h=[Math.floor(this.previousOfCurrent[0]+.5),Math.floor(this.previousOfCurrent[1]+.5),Math.floor(this.previousOfCurrent[2]+.5)];let u=Math.floor(h[0]+.5);const d=Math.floor(h[1]+.5);let m=Math.floor(h[2]+.5);const f=Math.floor(u/16),y=Math.floor(m/16),k=c.getEntityByName(`Chunk[${f},${y}]`);if(k&&d>-1&&d<k.getChunkHeight()){const E=[u,d,m],b=new z([E[0]-.5,E[1]-.5,E[2]-.5],[E[0]+.5,E[1]+.5,E[2]+.5],1,1,1);this.physics.aabb.intersects(b)||(x.play("place"),k.mesh.addBlock(this.previousOfCurrent),this.toolbar.removeCurrentItem())}}if(M.wasMouseJustPressed(2)&&this._toolbar.currentItem.source==H.TOOL&&this._toolbar.currentItem.value==A.PENCIL){const h=c.getEntityByName("RedCube");h.position=i.position;const u=c.getEntityByName("GreenCube");this.drawChunkBetweenPoints(u.position,h.position)}}M.isKeyPressed("Control")&&this.creativeMode?this.ctrlPressed||(this.flyMode=!this.flyMode,this.ctrlPressed=!0):this.ctrlPressed=!1,this.raycastForward(2.5,.1,t),this.accumulatedTime+=Math.min(e,.1);let n=0;for(;this.accumulatedTime>=this.fixedStep&&n<5;)this.fixedUpdate(this.fixedStep),this.accumulatedTime-=this.fixedStep,n++;const r=this.accumulatedTime/this.fixedStep,a=Kt(U(),this.previousPosition,this.currentPosition,r);this.camera.setPosition(a),c.updateViewMatrix(this.camera.getViewMatrix())}fixedUpdate(t){this.jumpCooldownTimer>0&&(this.jumpCooldownTimer-=t);const e=N(this.currentPosition),{front:s,right:i,up:n}=this.camera.getDirectionVectors(),r=$(s[0],0,s[2]);nt(r,r);const a=this.speed*t,h=U();let u=!1;if(this._joystick.isActive()){const y=this._joystick.getDirection();st(h,h,r,a*y.y),st(h,h,i,a*y.x),(y.x!==0||y.y!==0)&&(u=!0)}const d=U();I.PLAYERPAUSED||((M.isKeyPressed("w")||M.isKeyPressed("arrowup"))&&Bt(d,d,r),(M.isKeyPressed("s")||M.isKeyPressed("arrowdown"))&&Mt(d,d,r),(M.isKeyPressed("a")||M.isKeyPressed("arrowleft"))&&Mt(d,d,i),(M.isKeyPressed("d")||M.isKeyPressed("arrowright"))&&Bt(d,d,i),Ht(d)>0&&(u=!0,nt(d,d),st(h,h,d,a)),this.flyMode?(M.isKeyPressed(" ")&&(h[1]=-a,u=!0),M.isKeyPressed("Shift")&&(h[1]=a,u=!0)):(M.isKeyPressed(" ")&&this.jumpCooldownTimer<=0&&(this.jumpCooldownTimer=this.JUMP_COOLDOWN,this.physics.jump()),M.isKeyPressed("Shift")&&st(e,e,n,-a)));const m=this.physics.update(h,t);this.currentPosition=N(m);const f=this.physics.getIsOnGround();!f&&this._wasOnGroundLastFrame&&(this.coyoteTime=this.COYOTE_TIME_MAX),this.coyoteTime>0&&(this.coyoteTime-=t),f&&this._hitGround?(this._hitGround=!1,this.jumpCooldownTimer=0,this._firstTimeHitted?this.playerOnTopOfGrassOrDirt?x.play("footstepsOnGrass"):x.play("footsteps"):this._firstTimeHitted=!0):!f&&!this._hitGround&&(this._hitGround=!0),u&&f?(this._footstepTimer+=t,this._footstepTimer>=this._footstepInterval&&(this.playerOnTopOfGrassOrDirt?x.play("footstepsOnGrass"):x.play("footsteps"),this._footstepTimer=0)):this._footstepTimer=0,this.previousPosition=N(this.currentPosition),this._wasOnGroundLastFrame=f,this.physics.getVelocity()[1]>0&&this.physics.setIsOnGround(!1)}get joystick(){return this._joystick}set joystick(t){this._joystick=t}get toolbar(){return this._toolbar}set toolbar(t){this._toolbar=t}}class Tt extends lt{constructor(t,e){const s=[-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5],i=[0,1,2,1,3,2,4,5,6,5,7,6,8,9,10,9,11,10,12,13,14,13,15,14,16,17,18,17,19,18,20,21,22,21,23,22],n=[];for(let a=0;a<s.length/3;a++)n.push(e[0],e[1],e[2]);const r=new At(s,i,Dt,n);super(t,r),this.scale=[1.1,1.1,1.1]}update(t,e){var i,n;c.getEntityByName("Player").toolbar.currentItem.value==A.PENCIL?((i=c.getEntityByName("WireframeChunk"))==null||i.setVisible(!0),this.visible=!0):((n=c.getEntityByName("WireframeChunk"))==null||n.setVisible(!1),this.visible=!1)}}const ne=`
attribute vec3 aPosition;
attribute vec3 aColor;
uniform mat4 uModel;
uniform mat4 uView;
uniform mat4 uProjection;
varying vec3 vColor;
void main() {
    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);
    vColor = aColor;
}
`,oe=`
precision mediump float;
varying vec3 vColor;
void main() {
    gl_FragColor = vec4(vColor, 1.0);
}
`,ae=new gt(ne,oe);class re extends lt{constructor(t){const e=[[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5],[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5]],s=[4,5,6,4,6,7,1,0,3,1,3,2,0,4,7,0,7,3,5,1,2,5,2,6,3,7,6,3,6,2,0,1,5,0,5,4];function i([y,k,E],b,w){return[y*w[0]+b[0],k*w[1]+b[1],E*w[2]+b[2]]}const n=.005,r=1.005,a=[{position:[.5,.5,0],scale:[n,n,r]},{position:[-.5,.5,0],scale:[n,n,r]},{position:[0,.5,.5],scale:[r,n,n]},{position:[0,.5,-.5],scale:[r,n,n]},{position:[.5,0,.5],scale:[n,r,n]},{position:[.5,0,-.5],scale:[n,r,n]},{position:[-.5,0,-.5],scale:[n,r,n]},{position:[-.5,0,.5],scale:[n,r,n]},{position:[0,-.5,.5],scale:[r,n,n]},{position:[0,-.5,-.5],scale:[r,n,n]},{position:[.5,-.5,0],scale:[n,n,r]},{position:[-.5,-.5,0],scale:[n,n,r]}],h=[],u=[];let d=0;for(const{position:y,scale:k}of a){for(const E of e){const[b,w,R]=i(E,y,k);h.push(b,w,R)}for(const E of s)u.push(E+d);d+=8}const m=[];for(let y=0;y<h.length/3;y++)m.push(t[0],t[1],t[2]);const f=new At(h,u,ae,m);super("OutlineCube",f),this.setVisible(!1)}}class Y{constructor(){this.sceneId="SceneName"}init(t){this.start(t),this.run(),this.end()}start(t){M.initialize(),c.init(`Level${t}`,t),c.addEntity(new re([0,0,0]))}end(){c.addEntity(new Tt("GreenCube",[0,1,0])),c.addEntity(new Tt("RedCube",[1,0,0])),c.startLoadingBlockData=!0,c.updateProjectionMatrix(),c.updateViewMatrix();const t=c.getEntityByName("Player");t.toolbar.init(),t.toolbar.highlightSlot(1)}}class le extends Y{constructor(){super(...arguments),this.sceneId="Level0"}run(){new Date().getTime(),c.addEntity(new W([2.66,2.302,12.3])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-2]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"GUIDE01",chunkWidth:4,chunkHeight:4,chunkDepth:5,block:g.BRICKWOOD,scale:[1,1,1],position:[1,1,10],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="block");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA",chunkWidth:4,chunkHeight:4,chunkDepth:4,block:g.BRICKWOOD,scale:[1,1,1],dontCreateBlocks:!0,position:[1,1,5],isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE02",chunkWidth:4,chunkHeight:4,chunkDepth:4,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[1,1,1],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="block");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA2",chunkWidth:4,chunkHeight:4,chunkDepth:2,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[5,1,1],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE03",chunkWidth:3,chunkHeight:4,chunkDepth:2,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[9,1,1],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="block");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA3",chunkWidth:3,chunkHeight:4,chunkDepth:14,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[12,2,1],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new D({nameId:"ItemPickupShovel",handItem:!1,scale:[1/16,1/16,1/16],position:[13,3,12-.5],tool:A.SHOVEL,pickupItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[6+.5,2,-10-.5],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new p({nameId:"GUIDE04",chunkWidth:6,chunkHeight:4,chunkDepth:3,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,2,12],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="block");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA4",chunkWidth:3,chunkHeight:4,chunkDepth:2,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,2,9],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE05",chunkWidth:3,chunkHeight:4,chunkDepth:2,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,2,7],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="block");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA5",chunkWidth:3,chunkHeight:6,chunkDepth:7,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,4,0],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE06",chunkWidth:3,chunkHeight:6,chunkDepth:2,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,1,-2],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="block");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA6",chunkWidth:3,chunkHeight:6,chunkDepth:6,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,1,-8],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE07",chunkWidth:3,chunkHeight:6,chunkDepth:6,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,1,-15],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="block");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"SILENCEAREA7",chunkWidth:3,chunkHeight:6,chunkDepth:6,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,1,-24],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),c.addEntity(new p({nameId:"GUIDE08",chunkWidth:3,chunkHeight:6,chunkDepth:7,block:g.BRICKWOOD,scale:[1,1,1],visible:!1,position:[6,1,-31],dontCreateBlocks:!0,isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="block")}})),c.addEntity(new p({nameId:"Portal",chunkWidth:1,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,position:[7,1,-32],animating:[g.PORTAL1,g.PORTAL2],isCollidable:()=>{const t=document.getElementById("guide01");t&&(t.style.display="none");const e=document.getElementById("guide02");e&&(e.style.display="none");const s=document.getElementById("guide03");s&&(s.style.display="none");const i=document.getElementById("guide04");i&&(i.style.display="none");const n=document.getElementById("guide05");n&&(n.style.display="none");const r=document.getElementById("guide06");r&&(r.style.display="none");const a=document.getElementById("guide07");a&&(a.style.display="none");const h=document.getElementById("guide08");h&&(h.style.display="none")}})),new Date().getTime()}}class he extends Y{constructor(){super(...arguments),this.sceneId="Level1"}run(){c.addEntity(new W([2.66,2.302,12.3])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:2,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,position:[2,8,-1],animating:[g.PORTAL1,g.PORTAL2]}))}}class ce extends Y{constructor(){super(...arguments),this.sceneId="Level2"}run(){c.addEntity(new W([7.59,12.21,7.71])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5,10,-9],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-2]",block:g.GRASS,loadFromJson:!0,chunkHeight:20})),c.addEntity(new p({nameId:"Chunk[1,-2]",block:g.GRASS,loadFromJson:!0,chunkHeight:20})),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:2,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[26,16,-19],animating:[g.PORTAL1,g.PORTAL2]}))}}class ue extends Y{constructor(){super(...arguments),this.sceneId="Level3"}run(){c.addEntity(new W([7,3,9])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+14,2,5],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupShovel",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+-9,7,28],tool:A.SHOVEL,pickupItem:!0},16)),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:1,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[-2,6,31],animating:[g.PORTAL1,g.PORTAL2]}))}}class de extends Y{constructor(){super(...arguments),this.sceneId="Level4"}run(){c.addEntity(new W([7,3,9])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[1,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[1,0]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,-1]",block:g.GRASS,loadFromJson:!0})),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+25,2,-10],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupShovel",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+7,2,14],tool:A.SHOVEL,pickupItem:!0},16)),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:2,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[-15,1,-1],animating:[g.PORTAL1,g.PORTAL2]}))}}class me extends Y{constructor(){super(...arguments),this.sceneId="Level5"}run(){c.addEntity(new W([7+.5+.25/2,3,7+.5+.25/2])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,-1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[1,-1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,0]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[1,1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[-1,-1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+18,2,-3],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupShovel",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+28,2,24],tool:A.SHOVEL,pickupItem:!0},16)),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:2,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[-9,1,-16],animating:[g.PORTAL1,g.PORTAL2]}))}}class ge extends Y{constructor(){super(...arguments),this.sceneId="Level6"}run(){c.addEntity(new W([7+.5+.25/2,3,7+.5+.25/2])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,1]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new p({nameId:"Chunk[0,2]",block:g.LABBLOCK,loadFromJson:!0})),c.addEntity(new D({nameId:"ItemPickupGoldenShovel",handItem:!1,scale:[1/16,1/16,1/16],position:[7-.5+.25/2,2,7+.5+.25/2],tool:A.GOLDENSHOVEL,pickupItem:!0},16)),c.addEntity(new D({nameId:"ItemPickupGoldenShovel2",handItem:!1,scale:[1/16,1/16,1/16],position:[1-.5+.25/2,2,35+.5+.25/2],tool:A.GOLDENSHOVEL,pickupItem:!0},16)),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:2,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[6,1,40],animating:[g.PORTAL1,g.PORTAL2]}))}}class fe extends Y{constructor(){super(...arguments),this.sceneId="Level7"}run(){c.addEntity(new W([0+.5+.25/2,3,14+.5+.25/2])),c.addEntity(new D({nameId:"HandItemTool",handItem:!0},16)),c.addEntity(new p({nameId:"HandItemCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.GRASS,handItem:!0,scale:[1,1,1],createMeshNow:!0})),c.addEntity(new p({nameId:"Chunk[0,0]",block:g.LABBLOCK,chunkHeight:32,loadFromJson:!0})),c.addEntity(new D({nameId:"ItemPickupPickaxe",handItem:!1,scale:[1/16,1/16,1/16],position:[-.5+6,16,7],tool:A.PICKAXE,pickupItem:!0},16)),c.addEntity(new p({nameId:"BreakingCube",chunkWidth:1,chunkHeight:1,chunkDepth:1,block:g.BREAK1,scale:[1.001,1.001,1.001],createMeshNow:!0,visible:!1})),c.addEntity(new p({nameId:"Portal",chunkWidth:1,chunkHeight:2,chunkDepth:1,block:g.PORTAL1,scale:[1,1,1],createMeshNow:!0,visible:!0,fillAll:!0,globalPosition:[7,29,15],animating:[g.PORTAL1,g.PORTAL2]}))}}class wt{init(t){this.start(t),this.run(),this.end()}start(t){c.init(`Level${t}`,t)}run(){c.addEntity(new p({nameId:"Chunk[0,0]",block:g.LABBLOCK,chunkHeight:32,loadFromJson:!0}))}end(){c.startLoadingBlockData=!0,c.updateProjectionMatrix()}}class rt{static goToLevelSelection(){const t=document.getElementById("levelSelection"),e=document.getElementById("menu");t&&(t.style.display="flex",t.style.opacity="1"),e&&(e.style.display="none")}static async goToLevelSelectionMenu(){c.initLoadingBar(),I.GAMEPAUSED=!0,P.style.opacity="0";const t=document.getElementById("hud");t&&(t.style.opacity="0"),await c.waitNextFrame(),await c.waitNextFrame(),c.mainMenuScene=!0,I.MENUON=!1,I.destroyEventListeners();const e=new wt;if(!e)throw new Error("Scene not found!");c.clearEntities(),e.init(7);const s=document.getElementById("shadow");s&&(s.style.display="block"),rt.goToLevelSelection()}static async restartLevel(){const t=c.getEntityByName("Player");t.getCamera().ignoreNextClick=!0,c.initLoadingBar(),P.style.opacity="0";const e=document.getElementById("hud");e&&(e.style.opacity="0"),I.GAMEPAUSED=!0,await c.waitNextFrame(),await c.waitNextFrame(),I.MENUON=!1,P.requestPointerLock(),I.switchToAnotherLevel("Level"+c.LEVELNUMBER,c.LEVELNUMBER)}static howToPlayButton(){const t=c.getEntityByName("Player");t.getCamera().ignoreNextClick=!0,rt.howToPlayPage()}static howToPlayPage(){I.MENUON=!0;const t=document.getElementById("pauseMenu");t&&(t.style.display="none");const e=document.getElementById("howToPlayPage");e&&(e.style.display="flex");const s=document.getElementById("hud");s&&(s.style.opacity="0")}static pauseMenu(){const t=document.getElementsByClassName("anchor")[0];t&&(t.style.opacity="0");const e=c.getEntityByName("Player");e.getCamera().ignoreNextClick=!0;const s=!I.MENUON;I.PLAYERPAUSED=s,I.GAMEPAUSED=s,I.MENUON=s,s||P.requestPointerLock()}static goToMainMenu(){const t=document.getElementById("levelSelection"),e=document.getElementById("menu");t&&(t.style.display="none"),e&&(e.style.display="flex")}static init(){function t(){const f=c.getEntityByName("Player");f.getCamera().ignoreNextClick=!0}const e=document.getElementById("sensitivityMenu");e&&(e.onpointerdown=t,e.addEventListener("input",f=>{const y=f.target,k=c.getEntityByName("Player");k.getCamera().sensitivity=parseFloat(y.value)}));const s=document.getElementById("playButton");s&&(s.onclick=this.goToLevelSelection);const i=document.getElementById("levelSelectionButton");i&&(i.onpointerdown=this.goToLevelSelectionMenu);const n=document.getElementById("goToMainMenu");n&&(n.onclick=this.goToMainMenu);const r=document.getElementById("restartButton");r&&(r.onpointerdown=this.restartLevel);const a=document.getElementById("pauseButton");a&&(a.onpointerdown=this.pauseMenu);const h=document.getElementById("howToPlayButton");h&&(h.onpointerdown=this.howToPlayButton);const u=localStorage.getItem("fabrirama_lastlevel"),d=u?parseInt(u):0,m=document.getElementsByClassName("levelButton");for(let f=0;f<m.length;f++){const y=m[f],k=parseInt(y.innerHTML);k>d&&(y.setAttribute("disabled","true"),y.classList.add("disabled")),y.addEventListener("mousedown",async()=>{const E=document.getElementById("levelSelection"),b=document.getElementById("menu"),w=document.getElementById("shadow");E&&(E.style.display="none"),b&&(b.style.display="none"),w&&(w.style.display="none"),P.style.opacity="0",I.MENUON=!1,I.GAMEPAUSED=!0,I.PLAYERPAUSED=!0,c.mainMenuScene=!1,c.initLoadingBar();const R=document.getElementById("hud");R&&(R.style.opacity="0"),await c.waitNextFrame(),await c.waitNextFrame(),I.switchToAnotherLevel("Level"+k,k,!0)})}}}const Ft=[new le,new he,new ce,new ue,new de,new me,new ge,new fe],Rt=(o,t)=>{let e;return t?e=o+t:e=o,Ft.find(s=>s.sceneId===e)},ot=class ot{static set MENUON(t){if(t){const e=document.getElementById("pauseMenu");e&&(e.style.display="flex")}else{const e=document.getElementsByClassName("anchor")[0];e&&(e.style.opacity="1");const s=document.getElementById("pauseMenu");s&&(s.style.display="none");const i=document.getElementById("howToPlayPage");i&&(i.style.display="none")}this._MENUON=t}static get MENUON(){return this._MENUON}static destroyEventListeners(){const t=c.getEntityByName("Player");t.getCamera().destroy(),t.getCamera().touchManager.destroy(),t.joystick.destroy(),M.destroy()}static updateLevelButtonsState(){const t=localStorage.getItem("fabrirama_lastlevel"),e=t?parseInt(t):1,s=document.getElementsByClassName("levelButton");for(let i=0;i<s.length;i++){const n=s[i];parseInt(n.innerHTML)>e?(n.disabled=!0,n.classList.add("disabled")):(n.disabled=!1,n.classList.remove("disabled"))}}static async switchToAnotherLevel(t,e,s){const i=document.getElementById("guide01");i&&(i.style.display="none");const n=document.getElementById("guide02");n&&(n.style.display="none");const r=document.getElementById("guide03");r&&(r.style.display="none");const a=document.getElementById("guide04");a&&(a.style.display="none");const h=document.getElementById("guide05");h&&(h.style.display="none");const u=document.getElementById("guide06");u&&(u.style.display="none");const d=document.getElementById("guide07");d&&(d.style.display="none");const m=document.getElementById("guide08");m&&(m.style.display="none"),P.style.opacity="0",this.GAMEPAUSED=!0,this.PLAYERPAUSED=!0,s||this.destroyEventListeners();let f,y=c.LEVELNUMBER,k="";if(e==null?y++:y=e,t?(f=Rt(t),k=t):(f=Rt("Level",y),k="Level"+y),Ft.length==y){c.mainMenuScene=!0;const w=document.getElementById("hud");w&&(w.style.opacity="0");const R=document.getElementById("shadow");R&&(R.style.display="block");const v=new wt;c.clearEntities(),v.init(7),rt.goToMainMenu(),document.exitPointerLock();return}if(!f)throw new Error(`Scene ${k} not found!`);const E=localStorage.getItem("fabrirama_lastlevel");(E?parseInt(E):0)<y&&localStorage.setItem("fabrirama_lastlevel",String(y)),this.updateLevelButtonsState(),c.clearEntities(),f.init(y),await c.waitNextFrame(),await c.waitNextFrame()}};ot.GAMEPAUSED=!0,ot.PLAYERPAUSED=!0,ot._MENUON=!1;let I=ot;const S=class S{static initialize(){this.keyDownListener=s=>{S.keysPressed.add(s.key.toLowerCase())},window.addEventListener("keydown",this.keyDownListener),this.keyUpListener=s=>{S.keysPressed.delete(s.key.toLowerCase())},window.addEventListener("keyup",this.keyUpListener),this.mouseDownListener=s=>{if(document.pointerLockElement!==document.querySelector("#glCanvas"))return;const i=document.querySelector(".mobileButtonBackground");if(i){const n=i.getBoundingClientRect();if(s.clientX>=n.left&&s.clientX<=n.right&&s.clientY>=n.top&&s.clientY<=n.bottom)return}S.mouseButtonsPressed.add(s.button)},window.addEventListener("mousedown",this.mouseDownListener),this.mouseUpListener=s=>{if(document.pointerLockElement!==document.querySelector("#glCanvas"))return;const i=document.querySelector(".mobileButtonBackground");if(i){const n=i.getBoundingClientRect();if(s.clientX>=n.left&&s.clientX<=n.right&&s.clientY>=n.top&&s.clientY<=n.bottom)return}S.mouseButtonsPressed.delete(s.button)},window.addEventListener("mouseup",this.mouseUpListener);let t=0;const e=200;this.wheelListener=()=>{if(I.PLAYERPAUSED)return;const s=Date.now();s-t<e||(t=s,c.getEntityByName("Player").toolbar.nextItem())},window.addEventListener("wheel",this.wheelListener)}static destroy(){this.keysPressed=new Set,window.removeEventListener("keydown",this.keyDownListener),window.removeEventListener("keyup",this.keyUpListener),window.removeEventListener("mousedown",this.mouseDownListener),window.removeEventListener("mouseup",this.mouseUpListener),window.removeEventListener("wheel",this.wheelListener)}static wasKeyJustPressed(t){const e=t.toLowerCase(),s=S.keysPressed.has(e),i=S.previousKeysPressed.has(e);return s&&!i?(S.previousKeysPressed.add(e),!0):(!s&&i&&S.previousKeysPressed.delete(e),!1)}static wasMouseJustPressed(t){return this.mouseButtonsPressedThisFrame.has(t)}static wasMouseJustReleased(t){return this.mouseButtonsReleasedThisFrame.has(t)}static isKeyPressed(t){return S.keysPressed.has(t.toLowerCase())}static isMouseButtonPressed(t){return S.mouseButtonsPressed.has(t)}static update(){this.mouseButtonsPressedThisFrame.clear(),this.mouseButtonsReleasedThisFrame.clear();for(let t=0;t<=2;t++){const e=this.mouseButtonsPressed.has(t),s=this.previousMouseButtonsPressed.has(t);e&&!s&&this.mouseButtonsPressedThisFrame.add(t),!e&&s&&this.mouseButtonsReleasedThisFrame.add(t)}this.previousMouseButtonsPressed=new Set(this.mouseButtonsPressed)}static pressLeftClick(){S.mouseButtonsPressed.add(0)}static releaseLeftClick(){S.mouseButtonsPressed.delete(0)}static pressRightClick(){S.mouseButtonsPressed.add(2)}static releaseRightClick(){S.mouseButtonsPressed.delete(2)}static pressJumpButton(){const t=c.getEntityByName("Player");t.getCamera().ignoreNextClick=!0,S.keysPressed.add(" ")}static releaseJumpButton(){S.keysPressed.delete(" ")}};S.keysPressed=new Set,S.previousKeysPressed=new Set,S.mouseButtonsPressed=new Set,S.previousMouseButtonsPressed=new Set,S.mouseButtonsPressedThisFrame=new Set,S.mouseButtonsReleasedThisFrame=new Set;let M=S;const ye=`
attribute vec3 aPosition;
attribute vec2 aTexCoord;
attribute float aBrightness;

uniform mat4 uModel;
uniform mat4 uView;
uniform mat4 uProjection;

varying vec2 vTexCoord;
varying float vBrightness;

void main() {
    vTexCoord = aTexCoord;
    vBrightness = aBrightness;
    gl_Position = uProjection * uView * uModel * vec4(aPosition, 1.0);
}
`,pe=`
precision mediump float;

uniform sampler2D uTexture;
varying vec2 vTexCoord;
varying float vBrightness;

void main() {
    vec4 texColor = texture2D(uTexture, vTexCoord);
    gl_FragColor = vec4(texColor.rgb * vBrightness, texColor.a);
}
`,Pt=new gt(ye,pe);class p extends lt{constructor(t){const{nameId:e,chunkWidth:s=16,chunkHeight:i=16,chunkDepth:n=16,block:r=g.AIR,handItem:a=!1,scale:h=[1,1,1],drawLinesInsteadTriangles:u=!1,createMeshNow:d=!1,loadFromJson:m=!1,fillAll:f=!1,visible:y=!0,position:k=[0,0,0],animating:E=null,globalPosition:b=null,isCollidable:w=null,dontCreateBlocks:R=!1}=t,v=[],L=[];let T=g.AIR;if(f&&(T=r),!R){for(let O=0;O<s;O++){v[O]=[],L[O]=[];for(let F=0;F<i;F++){v[O][F]=[],L[O][F]=[];for(let G=0;G<n;G++)v[O][F][G]=T,L[O][F][G]=[null,null,null,null,null,null]}}for(let O=0;O<s;O++)for(let F=0;F<n;F++)v[O][0][F]=r}const B=new Lt(L,Pt,u);if(super(e,B),this.isCollidable=null,this.lastTime=0,this.frame=0,this.interval=400,this.mesh=B,this.mesh.chunk=this,this.blocks=v,this.chunkWidth=s,this.chunkHeight=i,this.chunkDepth=n,this.animating=E,this.isCollidable=w,a)this.scale=[.05,.05,.05],this.position=[.05,-.08,-.1],this.handItem=!0,this.rotate90=!1,this.visible=!1;else{if(this.scale=h,this.visible=y,k&&(this.position=k),e.includes("Chunk[")){const O=e.match(/\[(-?\d+),(-?\d+)\]/);if(O){const F=parseInt(O[1]),G=parseInt(O[2]);this.position[0]=F*s,this.position[2]=G*n,this.chunkHelper=this.addChunkHelper(F,G),this.chunkHelper.visible=!1}}b&&(this.position=b)}d&&B.generateMeshData(this),this._loadFromJson=m}addChunkHelper(t,e){const s=new p({nameId:`ChunkHelper[${t},${e}]`,chunkWidth:this.chunkWidth,chunkHeight:this.chunkHeight,chunkDepth:this.chunkDepth,block:g.LEAVES,scale:[1,1,1],createMeshNow:!0,drawLinesInsteadTriangles:!0,fillAll:!0});return s.position=this.position,c.addEntity(s),s}async init(){this.loadFromJson&&await this.loadBlocksFromFile(`chunks/${c.SCENENAME}/${this.nameId}.json`)}fillBasedLength(t){const e=Math.floor(this.position[0]),s=Math.floor(this.position[1]),i=Math.floor(this.position[2]),n=e+this.chunkWidth,r=s+this.chunkHeight,a=i+this.chunkDepth;for(let h=e;h<n;h++)for(let u=s;u<r;u++)for(let d=i;d<a;d++){let m=h,f=d;const y=Math.floor(m/16),k=Math.floor(f/16),E=c.getEntityByName(`Chunk[${y},${k}]`);E&&u>-1&&u<E.getChunkHeight()&&E.mesh.addBlock([m,u,f],t,!0)}}async update(t,e){if(this.isCollidable){const i=c.getEntityByName("Player"),n=[Math.floor(this.position[0]+.5),Math.floor(this.position[1]+.5),Math.floor(this.position[2]+.5)];let r=Math.floor(n[0]+.5);const a=Math.floor(n[1]+.5);let h=Math.floor(n[2]+.5);const u=Math.floor(r/16),d=Math.floor(h/16),m=c.getEntityByName(`Chunk[${u},${d}]`);if(m&&a>-1&&a<m.getChunkHeight()){const f=[r,a,h],y=new z([f[0]-.5,f[1]-.5,f[2]-.5],[f[0]+this.chunkWidth-.5,f[1]+this.chunkHeight+.5,f[2]+(this.chunkDepth-1)+.5],1,1,1);i.getPhysics().aabb.intersects(y)&&!I.GAMEPAUSED&&this.isCollidable()}}if(this.animating){if(t-this.lastTime>=this.interval){this.frame=1-this.frame,this.lastTime=t;for(let f=0;f<this.chunkWidth;f++)this.mesh.removeBlock([f,0,0]),this.mesh.removeBlock([f,1,0]),this.mesh.addBlock([f,0,0],this.animating[this.frame]),this.mesh.addBlock([f,1,0],this.animating[this.frame])}const i=c.getEntityByName("Player"),n=[Math.floor(this.position[0]+.5),Math.floor(this.position[1]+.5),Math.floor(this.position[2]+.5)];let r=Math.floor(n[0]+.5);const a=Math.floor(n[1]+.5);let h=Math.floor(n[2]+.5);const u=Math.floor(r/16),d=Math.floor(h/16),m=c.getEntityByName(`Chunk[${u},${d}]`);if(m&&a>-1&&a<m.getChunkHeight()){const f=[r,a,h],y=new z([f[0]-.5,f[1]-.5,f[2]-.5],[f[0]+this.chunkWidth-.5,f[1]+.5,f[2]+.5],1,1,1);if(i.getPhysics().aabb.intersects(y)&&!I.GAMEPAUSED){c.initLoadingBar(),P.style.opacity="0";const k=document.getElementById("hud");k&&(k.style.opacity="0"),I.GAMEPAUSED=!0,await c.waitNextFrame(),I.switchToAnotherLevel();return}}}if(I.PLAYERPAUSED)return;const s=c.getEntityByName("Player");if(M.wasKeyJustPressed("c")){const i=[Math.floor(s.getCamera().position[0]+.5),Math.floor(s.getCamera().position[1]+.5),Math.floor(s.getCamera().position[2]+.5)];let n=Math.floor(i[0]+.5),r=Math.floor(i[2]+.5);const a=Math.floor(n/16),h=Math.floor(r/16),u=c.getEntityByName(`Chunk[${a},${h}]`);u&&this.copyBlocksToClipboard(u)}if(M.wasKeyJustPressed("q")&&s.creativeMode){for(const d of c.getEntities().values())d.getNameId().includes("ChunkHelper[")&&d.setVisible(!d.getVisible());const i=[Math.floor(s.getCamera().position[0]+.5),Math.floor(s.getCamera().position[1]+.5),Math.floor(s.getCamera().position[2]+.5)];let n=Math.floor(i[0]+.5),r=Math.floor(i[2]+.5);const a=Math.floor(n/16),h=Math.floor(r/16);c.getEntityByName(`Chunk[${a},${h}]`)&&console.log(a,h)}}copyBlocksToClipboard(t){const e=JSON.stringify(t.getBlocks());navigator.clipboard.writeText(e).then(()=>console.log("Blocks copied to clipboard")).catch(s=>console.error("Failed to copy blocks:",s))}async loadBlocksFromFile(t){try{const e=await fetch(t);if(!e.ok)throw new Error("Failed to load file: "+t);const s=await e.json();this.loadBlocksFromJSON(s)}catch(e){console.error("Error loading JSON file:",e)}}loadBlocksFromJSON(t){this.blocks=t}updateChunk(){this.mesh.updateBuffers()}updateWholeChunk(){const t=[];for(let e=0;e<this.chunkWidth;e++){t[e]=[];for(let s=0;s<this.chunkHeight;s++){t[e][s]=[];for(let i=0;i<this.chunkDepth;i++)t[e][s][i]=[null,null,null,null,null,null]}}this.mesh=new Lt(t,Pt),this.mesh.generateMeshData(this)}getBlocks(){return this.blocks}getChunkWidth(){return this.chunkWidth}getChunkHeight(){return this.chunkHeight}getChunkDepth(){return this.chunkDepth}get loadFromJson(){return this._loadFromJson}set loadFromJson(t){this._loadFromJson=t}}const C=class C{static set mainMenuScene(t){this._mainMenuScene=t}static get mainMenuScene(){return this._mainMenuScene}static createMeshOfChunks(){for(const[t,e]of this.entities.entries())t.match(/Chunk\[(-?\d+),(-?\d+)\]/)&&e instanceof p&&e.mesh.generateMeshData(e)}static initLoadingBar(){C.chunksLoaded=0,C.LOADINGPERCENT=0,this.chunksToLoadNumber=0,this.startLoadingBlockData=!1,this.startLoadingMeshData=!1,this.chunksLoadedMesh=0,this.updateChunksLoadedDescription(" ")}static init(t,e,s=!1){this.SCENENAME=t,this.LEVELNUMBER=e,this.initLoadingBar(),l.enable(l.DEPTH_TEST),l.enable(l.CULL_FACE),l.cullFace(l.BACK),l.frontFace(l.CCW),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA)}static clearEntities(){C.entities.clear()}static removeEntityByName(t){return C.entities.delete(t)}static getEntityByName(t){return C.entities.get(t)}static updateChunksLoadedDescription(t){const e=document.getElementById("chunksLoaded");e&&(e.innerHTML=t);const s=this.texturesToLoad+this.chunksToLoadNumber*2,i=this.texturesLoaded+this.chunksLoaded+this.chunksLoadedMesh;C.LOADINGPERCENT=Math.floor(i/s*100),t==" "&&(C.LOADINGPERCENT=0);const n=document.getElementById("loadingPercent");n&&(n.innerHTML=C.LOADINGPERCENT.toString()+"%");const r=document.getElementsByClassName("loading-bar")[0];r&&(r.style.width=C.LOADINGPERCENT.toString()+"%")}static async addEntity(t){C.entities.set(t.getNameId(),t),t.getNameId().match(/Chunk\[(-?\d+),(-?\d+)\]/)&&t instanceof p&&this.chunksToLoad.push(t)}static async loadBlocksData(){const t=/\[(-?\d+),(-?\d+)\]/;for(const[e,s]of this.entities)t.test(e)&&await s.init()}static updateViewMatrix(t){t?C.uView=t:Et(C.uView,[3,3,3],[0,0,0],[0,1,0]);for(const e of this.entities.values()){const s=e.mesh.getShader();s.use();const i=s.getUniformLocation("uView");l.uniformMatrix4fv(i,!1,C.uView)}}static updateViewMatrixAndOrbit(t,e){if(e)C.uView=e;else{const s=[8,10,8],i=15,n=10,r=.2;this.orbitAngle+=t*r;const a=s[0]+i*Math.cos(this.orbitAngle),h=s[2]+i*Math.sin(this.orbitAngle),u=[a,n,h];Et(C.uView,u,s,[0,1,0])}for(const s of this.entities.values()){const i=s.mesh.getShader();i.use();const n=i.getUniformLocation("uView");l.uniformMatrix4fv(n,!1,C.uView)}}static updateProjectionMatrix(){const e=Math.PI/180*90,s=P.width/P.height;Ut(C.uProjection,e,s,.01,100);for(const r of this.entities.values()){const a=r.mesh.getShader();a.use();const h=a.getUniformLocation("uProjection");h!=-1&&l.uniformMatrix4fv(h,!1,C.uProjection)}}static getEntities(){return C.entities}static waitNextFrame(){return new Promise(t=>requestAnimationFrame(()=>t()))}static async update(t,e){if(C.updateViewMatrixAndOrbit(e),this.startLoadingBlockData&&this.chunksToLoadNumber==0&&(this.chunksToLoadNumber=this.chunksToLoad.length),this.chunksToLoad.length>0&&this.startLoadingBlockData){const s=this.chunksToLoad.shift();s&&(this.updateChunksLoadedDescription(`Chunks ${this.chunksLoaded}/${this.chunksToLoadNumber}`),await s.init(),this.chunksToLoadMesh.push(s),this.chunksLoaded++,this.updateChunksLoadedDescription(`Chunks ${this.chunksLoaded}/${this.chunksToLoadNumber}`))}if(this.chunksToLoadMesh.length>0&&(this.chunksToLoadNumber==this.chunksToLoadMesh.length||this.startLoadingMeshData)&&this.startLoadingBlockData){this.startLoadingMeshData=!0;const s=this.chunksToLoadMesh.shift();s&&(this.updateChunksLoadedDescription(`Terrain ${this.chunksLoadedMesh}/${this.chunksToLoadNumber}`),s.mesh.generateMeshData(s),this.chunksLoadedMesh++,this.updateChunksLoadedDescription(`Terrain ${this.chunksLoadedMesh}/${this.chunksToLoadNumber}`))}if(!I.MENUON&&I.GAMEPAUSED&&this.chunksToLoadMesh.length==0&&this.chunksLoaded!=0){if(this.mainMenuScene){const s=document.getElementById("shadow");s&&(s.style.opacity="0.3");const i=document.getElementById("menu");i&&(i.style.opacity="1")}else{const s=document.getElementById("hud");s&&(s.style.opacity="1"),C.LEVELNUMBER!=0&&P.requestPointerLock()}this.mainMenuScene?P.style.opacity="1":setTimeout(()=>{P.style.opacity="1"},50),I.GAMEPAUSED=!1,I.PLAYERPAUSED=!1}if(!I.GAMEPAUSED||I.MENUON){for(const s of this.entities.values())s.update(t,e);M.update()}}static render(){for(const t of this.entities.values())t.mesh.render(t)}};C.entities=new Map,C.uView=q(),C.uProjection=q(),C.LEVELNUMBER=1,C.LOADINGPERCENT=0,C.chunksToLoad=[],C.chunksLoaded=0,C.chunksLoadedMesh=0,C.chunksToLoadMesh=[],C.startLoadingBlockData=!1,C.startLoadingMeshData=!1,C.chunksToLoadNumber=0,C.texturesToLoad=1,C.texturesLoaded=0,C.orbitAngle=0,C._mainMenuScene=!0;let c=C;class Ee{constructor(){if(this.lastTime=performance.now(),this.resizeCanvas=()=>{const t=window.devicePixelRatio||1;P.width=window.innerWidth*t,P.height=window.innerHeight*t,P.style.width=window.innerWidth+"px",P.style.height=window.innerHeight+"px",l.viewport(0,0,P.width,P.height),c.updateProjectionMatrix()},this.renderLoop=async t=>{const e=performance.now(),s=(e-this.lastTime)/1e3;this.lastTime=e,(!I.GAMEPAUSED||I.MENUON)&&(l.clearColor(.6,.8,1,1),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT)),await c.update(t,s),(!I.GAMEPAUSED||I.MENUON)&&c.render(),requestAnimationFrame(this.renderLoop)},!l)console.error("Error to initialize WebGL");else{const t=window.devicePixelRatio||1;P.width=window.innerWidth*t,P.height=window.innerHeight*t,P.style.width=window.innerWidth+"px",P.style.height=window.innerHeight+"px",l.viewport(0,0,P.width,P.height),l.clear(l.COLOR_BUFFER_BIT)}window.addEventListener("resize",this.resizeCanvas)}startRendering(){requestAnimationFrame(this.renderLoop)}}new ft;rt.init();x.loadSound("footstepsOnGrass","sounds/footsteps-on-grass.mp3");x.setVolume("footstepsOnGrass",.7);x.loadSound("footsteps","sounds/footsteps.wav");x.loadSound("jump","sounds/jump.wav");x.setVolume("jump",.3);x.loadSound("dig","sounds/dig.ogg");x.loadSound("pickaxe","sounds/pickaxe.ogg");x.setVolume("pickaxe",.2);x.loadSound("collect","sounds/collect.wav");x.setVolume("collect",.3);x.loadSound("place","sounds/place.wav");x.setVolume("place",.6);async function ke(){I.GAMEPAUSED=!0,I.PLAYERPAUSED=!0,P.style.opacity="0",c.updateChunksLoadedDescription("Textures 0/1"),new Ee().startRendering(),await $t("img/textureAtlasTransparent.png"),c.texturesLoaded=1,c.updateChunksLoadedDescription("Textures 1/1");const t=new wt;if(!t)throw new Error("Scene not found!");t.init(7)}ke().catch(console.error);
